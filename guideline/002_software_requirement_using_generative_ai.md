
# はじめに
本ドキュメントは人間向けドキュメントである。

# 生成AIにおけるソフトウェアの要求

## 要求工学とは
顧客から要求を獲得し、それを要求仕様として記述する技術分野を指す。
- REBOK

以下の8点から成り立つ
| 関連知識 | 内容 | 備考 |
|---|---|---|
|要求工学の基礎  |要求の定義とそのスコープや視点などの主要な概念や基礎技術に関する知識  |  |
|要求工学プロセス  |要求工学のプロセスとそれに関する主要な概念。技術に関する知識。  |  |
|要求獲得  |顧客を含むステークスホルダを明らかにし、会議やインタビューなどを通して要求を獲得する技術に関する知識  |  |
|要求分析  |要求事項を整理し、要求項目間の関係を明らかにし、優先順位付けなどを行い、実現すべき要求を明らかにし、絞り込む技術に関する知識。  |  |
|要求仕様化  |分析された要求を規定の書式や表記表で要求仕様書として記述する技術に関する知識。  |  |
|要求の検証・妥当性の確認・評価  |要求仕様書に矛盾がないことなどの正当性の確認や、要求仕様書が顧客の要求を満たしていることの妥当性の確認、あるいは、その達成の度合いを評価する技術などに関する知識  |  |
|要求の計画と管理  |要求管理を計画し、その遂行や成果物を管理する技術に関する知識  |  |
|実践の考慮点  |要求工学を実践する上で有用な知識  |  |

## 生成AIによる要求工学プロセスの支援
要求工学プロセス(要求獲得,分析,仕様化,検証)の支援に生成AIがどの程度活用できるかについて、簡単な例によって説明する。

```
このシステムは電話着信時に電話番号による。迷惑電話(SES、人材派遣会社からの技術者の提案などの営業電話、不動産電話など)、重要顧客などからひかり電話に電話がかかってきていて基本無視したいのだが迷惑電話が頻繁ににかかってきてしつこい。また、コールセンターとしての役割も兼任しておりIVRを導入しているが、それでもかけてくる。言った言わないの話もあるので録音しておきたい。ブラウザを通じて迷惑電話は居留守、アナウンスを流す、コールセンタ向けはIVR(DTMF、将来的には音声認識で振り分け)、重要顧客は着電などできるようにしたい。ブラウザを通じて発着信履歴、録音ファイル、電話番号に応じた設定(IVR/着信拒否/通常着信/録音有無/事前録音通知アナウンス有無など)を管理できるようにする。

```
- ペルソナ(仮想的な人物像)パターンを使用し、以下のように指示を出す

```
ペルソナパターン指示（Claude Code向け）
1. あなたの役割（ペルソナ）

あなたは **「ひかり電話＋IVR＋録音＋Web管理」**の要件を詰める専門家チームとして振る舞う。以下のペルソナを同時に演じ、矛盾があれば「意思決定が必要」と明示して論点整理する。

プロダクトマネージャ（PM）：要望をユーザー価値に翻訳し、MVP→拡張ロードマップを作る

コンタクトセンター設計者：IVR/転送/営業時間/録音/応対品質を前提に設計する

テレフォニー/VoIPエンジニア：ひかり電話/回線・SIP/録音/DTMF/通話制御の実現性を確認する

セキュリティ & 法務担当：録音告知、個人情報、保存期間、アクセス制御、監査ログを設計する

UX設計者：ブラウザ管理（番号別ルール、履歴、録音再生、検索、運用）を具体化する

2. 背景・課題（与件）

電話着信があり、電話番号に応じて対応を変えたい

迷惑電話（SES、人材派遣の営業、不動産など）が頻繁でしつこい

コールセンター用途も兼任し IVR導入済みでも突破してかけてくる

「言った言わない」対策で 録音を確実に残したい

ブラウザから以下を管理したい

迷惑電話：居留守/拒否/アナウンス（自動応答）

コールセンター向け：IVR（DTMF、将来的に音声認識で振り分け）

重要顧客：通常着信（必要なら優先着信）

発着信履歴、録音ファイル、番号別設定（IVR/拒否/通常/録音有無/録音告知アナウンス有無 etc）

3. 目的（ゴール）

迷惑電話のコストを最小化（人が出ない、突破されにくい、運用が楽）

重要顧客は取りこぼさない（着信/通知/優先度）

通話証跡として録音を残す（検索・再生・エクスポート・保全）

番号別ルールをWebで簡単に運用（変更履歴・権限・監査）

将来：音声認識で自動振り分け（段階導入）

4. 前提・制約（必ず確認して進める）

以下を不明点として列挙し、決まらないと仕様が確定しない点は「要確認事項」に入れること。

ひかり電話の提供形態（ホームゲートウェイ、SIP連携可否、内線/外線、同時通話数）

現在のIVR構成（PBX/クラウド/自前、DTMF処理の位置）

録音の法令/告知要件（国・業種・社内規程）、保存期間、開示・削除要件

ブラウザ管理の利用者（管理者/オペレータ/監査）と権限

重要顧客の定義（ホワイトリスト、CRM連携の有無）

迷惑電話判定（ブラックリスト、外部DB参照、スコアリング、手動登録）

通話の最終着地点（固定電話機で鳴らす/ソフトフォン/モバイル転送/通知だけ）

録音ファイルの保管場所（オンプレ/クラウド）、暗号化、バックアップ

5. 機能要件（Claude Codeはここを詳細化する）

以下の機能を ユースケース→画面→データ→API→例外まで落とし込む。

5.1 ルールエンジン（番号別設定）

電話番号（完全一致/部分一致/正規表現/国番号対応）でルール適用

優先順位（上から評価、マッチしたら確定、フォールバック既定ルール）

アクション種別

拒否（切断）

居留守（無音/呼出し継続→タイムアウト）

アナウンス再生（例: 営業お断り）→切断

IVRへ接続（DTMF）

通常着信（鳴動）

通常着信＋録音

付随設定

録音ON/OFF

録音告知アナウンスON/OFF（通話開始前/開始直後）

営業時間/休日カレンダーで分岐

リトライ/同番号の連続着信制御（しつこさ対策）

5.2 IVR（現状DTMF、将来音声認識）

メニュー設計（例：1=サポート、2=新規、3=その他）

DTMF無入力タイムアウト、再案内、オペレータ接続

将来拡張：音声認識ルーティング（キーワード、意図分類、誤判定時のフォールバック）

5.3 履歴・録音

発着信履歴：日時、番号、ルール適用結果、通話時間、録音有無、IVR経路、担当/転送先

録音：再生、ダウンロード/共有、タグ、メモ、保全（改ざん検知/ハッシュ）

検索：番号、期間、種別（迷惑/重要顧客/IVR）、タグ、担当

監査ログ：誰がルール変更/録音閲覧/ダウンロードしたか

5.4 ブラウザ管理画面

ルール一覧/作成/編集/テスト（番号を入れて「この番号はどう処理される？」を即確認）

ブラック/ホワイトリスト管理

アナウンス音源管理（アップロード、TTS将来、再生確認）

IVRフロー管理（簡易ツリー、音源割当、転送先設定）

履歴・録音の閲覧（権限により制限）

5.5 通知

重要顧客着信の通知（ブラウザ、メール、Slack等はオプションとして整理）

迷惑電話の発生レポート（番号ランキング等）

6. 非機能要件（ここも必ず具体化）

可用性（営業時間中の停止許容、冗長化）

同時通話数、録音容量、保存期間

セキュリティ：認証（SSOの要否）、RBAC、暗号化（保存/転送）、鍵管理

運用：バックアップ、監視、アラート、ログ保全

コンプライアンス：録音告知、個人情報、削除/開示プロセス

7. 出力フォーマット（Claude Codeが必ず出す成果物）

あなたは最終的に以下を Markdownで出力する：

要件定義（PRD）：目的/背景/スコープ/非スコープ/成功指標

主要ユーザーストーリー（管理者/オペ/監査）＋受け入れ条件

画面一覧（ワイヤーの文章説明でOK）＋画面ごとの入出力

データモデル案（Rule, PhoneNumberPattern, CallLog, Recording, Announcement, IVRNode, AuditLog, UserRoleなど）

API案（REST例：/rules, /calls, /recordings, /ivr, /announcements）

例外・エッジケース（番号非通知、海外番号、偽装番号、DTMF不達、録音失敗時の扱い等）

MVPとフェーズ計画（MVP＝DTMF＋録音＋ルール、次＝音声認識等）

要確認事項リスト（決めないと進められない項目を優先度つきで）

8. 進め方（会話スタイル）

まず 要確認事項を10〜20個挙げ、推奨の仮置き案も提示

その後、仮置きでPRD草案を作り、不足を埋めながら精緻化

結論は常に「MVPでやる/後回し/やらない」を明示する

```

出力:ChatGPTによる顧客要望の詳細化
```
要確認事項（10〜20）＋推奨の仮置き案（意思決定が必要な論点）

不明点は「仮置き」で進め、後で確定できるようにします。矛盾や選択肢がある箇所は 意思決定が必要 と明示します。

ひかり電話の取り込み方式（ホームゲートウェイ直収容／PBX経由／SIP連携可否）

仮置き：既存のひかり電話回線は維持し、SIP可能ならSIP trunk、不可なら FXO/ATA/ゲートウェイでPBXへ取り込み。

意思決定：SIPで制御できるかが全体コスト・実装難易度に直結。

現在のIVR基盤（クラウドIVR／Asterisk等自前／ビジネスフォン機能）

仮置き：DTMF IVRはPBX側（例：Asterisk/FreePBX等）で実装し、Web管理は別サービス。

同時通話数・呼量（ピーク）

仮置き：同時2〜5chを想定し設計（拡張可能）。

意思決定：録音容量・回線増設・PBX性能要件が変わる。

重要顧客の定義（ホワイトリスト／CRM連携）

仮置き：MVPは ホワイトリスト手動登録＋タグ（VIP/取引先/社内）。将来CRM連携。

迷惑電話判定（ブラックリスト／外部DB）

仮置き：MVPは 手動ブラックリスト＋パターン一致＋「連続着信抑制」。将来：外部番号DB/スコアリング。

「居留守」の定義（無音、呼出し継続、疑似音）

仮置き：呼出し音は相手側へ返しつつ内部は鳴らさない（相手は呼び出し中のまま→タイムアウト）を第一候補。

意思決定：回線/ゲートウェイが許容する制御に依存。

録音の対象（全通話／特定ルールのみ／IVR含む）

仮置き：MVPは **「通常着信＋録音」**と 「IVR経由は原則録音」（言った言わない対策）でON。

録音告知の方針（法務）

仮置き：MVPは「録音告知アナウンスON」をデフォルト（ルールでOFF可）。

意思決定：業種・地域・社内規程で必須/任意が変わる。

録音の保存期間

仮置き：90日（運用負担低）／重要タグは手動で延長（1年）を提案。

意思決定：容量・コスト・開示対応に影響。

録音の保管場所（オンプレ/クラウド）

仮置き：MVPはクラウドオブジェクトストレージ（暗号化）＋メタDB。オンプレは後回し。

利用者と権限（RBAC）

仮置き：Admin（全権）/ Operator（履歴・録音閲覧）/ Auditor（閲覧のみ・DL制限）をMVPから実装。

監査ログの粒度

仮置き：ルール変更、録音再生、DL、削除、権限変更は必須ログ。

最終着地点（固定電話機で鳴らす/ソフトフォン/転送）

仮置き：MVPは「固定電話機で鳴動」＋ブラウザ通知（将来ソフトフォン統合）。

通知チャネル（ブラウザ/メール/Slack）

仮置き：MVPはブラウザ内通知＋メール。Slackは後回し。

営業時間/休日カレンダー

仮置き：MVPは営業時間カレンダー（祝日手動）を搭載。外部カレンダー連携は後回し。

番号非通知・公衆電話・海外番号の扱い

仮置き：非通知はIVRへ、海外はデフォルト拒否（例外で許可）。

偽装番号（スプーフィング）対策の期待値

仮置き：MVPは「番号ベースのみ」で限界を明記。将来：通話事業者側機能/検知を検討。

「アナウンス」音源（録音アップロード/TTS）

仮置き：MVPは音源アップロード。TTSは後回し。

音声認識の導入時期

仮置き：MVPはDTMF固定。フェーズ2で音声認識（誤判定時はDTMFへフォールバック）。

法的な開示・削除手順

仮置き：MVPは管理者のみ削除可能＋削除ログ必須。開示はダウンロード＋メタ情報添付。

要件定義（PRD）
1. 背景

ひかり電話への着信が、迷惑営業（SES/派遣/不動産等）と重要顧客が混在し、運用コストと取り逃しリスクが高い。IVRを導入しても突破されるため、番号ベースの強制的な制御と録音証跡の一元管理が必要。

2. 目的（ゴール）

迷惑電話の対応コストを最小化（人が出ない・突破されにくい・運用が楽）

重要顧客の取りこぼし防止（優先着信/通知）

言った言わない対策として録音の確実な保存と検索

Webで番号別ルールを安全に運用（権限・変更履歴・監査）

将来の音声認識ルーティングへ段階的に拡張

3. スコープ（やる）

電話番号（＋パターン）に基づく着信制御ルール

IVR（DTMF）ルーティング（メニュー、タイムアウト、オペ接続）

通話履歴（発着信）・録音管理（再生・DL・検索・タグ）

Web管理画面（ルール/音源/IVR/履歴/録音/監査/ユーザー権限）

重要顧客着信の通知（最低限：ブラウザ内＋メール）

4. 非スコープ（MVPではやらない）

音声認識（ASR/NLU）による振り分け（フェーズ2）

外部の迷惑電話DB自動連携（フェーズ2/3）

CRM自動同期（フェーズ2）

端末（ソフトフォン）統合・通話発信UIのフル実装（要件次第で後回し）

5. 成功指標（KPI）

迷惑電話に人が応対した回数：80%削減

重要顧客の取り逃し：0件/月（または目標値）

着信ルール変更の反映時間：1分以内

録音検索→再生まで：10秒以内（P95）

監査ログ欠落：0件

主要ユーザーストーリー＋受け入れ条件（AC）
A. 管理者（Admin）

番号別ルールを作成・優先順位を設定したい

AC: ルールは優先順位付きで保存され、テストで適用結果が確認できる

AC: 変更は監査ログに「誰が・いつ・何を」を記録

迷惑番号をブラックリストに追加したい

AC: 追加直後から適用され、同番号の次回着信が指定アクションになる

録音告知のON/OFFをルール単位で変更したい

AC: 変更後の通話から告知が反映される（過去録音には影響しない）

B. オペレータ（Operator）

重要顧客から着信したら確実に気づきたい

AC: 通常着信＋ブラウザ通知（＋メール通知）が発火する

AC: 履歴に「重要顧客タグ/ルール結果」が残る

クレーム等の通話録音をすぐ探して再生したい

AC: 番号・期間・タグで検索でき、再生ができる

AC: 必要ならメモ/タグを付けられる（権限内）

C. 監査（Auditor）

ルール変更や録音閲覧の履歴を追跡したい

AC: 監査ログでフィルタ/検索でき、エクスポート可能

AC: 監査権限は録音DLの可否を制御できる

画面一覧（ワイヤー文章）＋入出力
1) ダッシュボード

直近着信、迷惑多発番号ランキング、重要顧客の未対応着信、録音未作成アラート

入力：期間フィルタ

出力：統計、最新ログ一覧

2) ルール一覧

ルール名/優先度/パターン/アクション/録音/告知/更新者/更新日時

操作：並び替え、ON/OFF、複製、削除

出力：ルール一覧、変更履歴リンク

3) ルール作成・編集

パターン（完全/部分/正規表現/国番号）、タグ（迷惑/重要/一般）、アクション、付随設定（録音/告知/営業時間分岐/連続着信制御）

「適用テスト」：番号を入れる→どのルールが当たるか表示

出力：保存結果、監査ログ生成

4) ブラック/ホワイトリスト

番号、名前（任意）、カテゴリ、メモ、最終着信、登録者

出力：CSVインポート/エクスポート（将来）

5) IVRフロー管理

ツリー表示：開始ノード→音源→DTMF分岐→転送先/録音設定

出力：フローのバージョン、テスト発信（将来）

6) 音源（アナウンス）管理

アップロード、再生、名称、用途（録音告知/営業お断り/営業時間外）

出力：音源ID、利用箇所

7) 通話履歴（発着信ログ）

一覧：日時、番号、方向（IN/OUT）、結果（拒否/居留守/IVR/着信）、通話時間、録音、タグ

詳細：IVR経路、担当/転送先、適用ルール、イベントタイムライン

出力：録音へのリンク

8) 録音詳細

再生、DL（権限）、共有リンク（将来）、タグ、メモ、ハッシュ（改ざん検知）

出力：監査ログ（閲覧/再生/DL）

9) ユーザー/権限（RBAC）

ユーザー、ロール割当、DL許可、閲覧範囲

出力：監査ログ

10) 監査ログ

イベント（ルール変更/閲覧/DL/削除/権限変更）、ユーザー、日時、対象ID

出力：エクスポート

データモデル案（概略）

User(id, name, email, status)

UserRole(user_id, role: Admin|Operator|Auditor, permissions_json)

PhoneNumberPattern(id, type: exact|contains|regex|anonymous|country, pattern, normalized_hint)

Rule(id, name, priority, enabled, pattern_id, category: spam|vip|normal, action_type, action_config_json, record_enabled, record_announce_enabled, schedule_id, anti_spam_config_json, created_by, updated_by, updated_at)

Schedule(id, timezone, business_hours_json, holidays_json)

Announcement(id, name, type: general|record_notice|spam_block|after_hours, file_uri, duration_ms, checksum, created_by)

IVRNode(id, flow_id, node_type: start|play|menu|transfer|hangup, prompt_announcement_id, timeout_ms, noinput_reprompt_node_id, transitions_json)

IVRFlow(id, name, version, status: draft|active, created_by, updated_at)

CallLog(id, direction: inbound|outbound, from_number, to_number, start_at, end_at, duration_sec, matched_rule_id, result: rejected|silent|announced|ivr|rung|connected, ivr_path_json, recording_id, agent_target, metadata_json)

Recording(id, call_log_id, storage_uri, format, size_bytes, started_at, ended_at, checksum_sha256, encryption_info_json, tags_json, memo, retention_until)

AuditLog(id, actor_user_id, action: rule_update|recording_play|recording_download|recording_delete|role_change|announcement_upload, target_type, target_id, at, diff_json, ip, user_agent)

API案（REST例）
認証

POST /auth/login（SSOは将来）

GET /me（権限含む）

ルール

GET /rules?enabled=&category=&q=

POST /rules

GET /rules/{id}

PUT /rules/{id}

POST /rules/{id}/test（入力番号→適用結果、マッチ理由）

リスト

GET /lists/black POST /lists/black DELETE /lists/black/{id}

GET /lists/white …

IVR

GET /ivr/flows POST /ivr/flows

GET /ivr/flows/{id} PUT /ivr/flows/{id}

POST /ivr/flows/{id}/activate（アクティブ化）

音源

GET /announcements

POST /announcements（multipart upload）

GET /announcements/{id}/stream

通話・録音

GET /calls?from=&to=&date_from=&date_to=&result=&has_recording=

GET /calls/{id}

GET /recordings?call_id=&q=

GET /recordings/{id}

GET /recordings/{id}/stream（再生）

POST /recordings/{id}/tags

POST /recordings/{id}/memo

POST /recordings/{id}/download（監査ログ付きで短期URL発行）

監査

GET /audit?actor=&action=&date_from=&date_to=

GET /audit/export

例外・エッジケース（設計で必ず扱う）

番号非通知：パターン anonymous として扱い、原則IVRへ（または拒否）。

海外番号/国番号：正規化（E.164相当）できない場合のフォールバック。

偽装番号（スプーフィング）：番号ベースの限界を明記。連続着信抑制で実害軽減。

DTMF不達：無入力扱い→再案内→オペ接続or切断。

録音失敗：CallLogに recording_failed を記録し、ダッシュボードでアラート。

ストレージ障害：録音アップロード再試行、失敗時はローカル退避（可能なら）。

ルールの競合：優先順位と「最長一致/最も具体的」等のタイブレーク規約を定義。

同番号の連続着信：一定時間内は自動で「アナウンス→切断」へ切替（設定可）。

営業時間外：IVR/アナウンス/留守録など分岐（MVPはアナウンス＋切断が簡単）。

プライバシー要求：録音の削除依頼・開示要求が来た場合の運用フロー（ログ必須）。

ダウンロード権限：Auditorは再生可・DL不可など、権限差分を明確化。

MVPとフェーズ計画（結論：MVPでやる/後回し/やらない）
フェーズ0（前準備・技術確定）— MVP前に必要

回線取り込み方式の確定（SIP可否、PBX/ゲートウェイ選定）

録音告知・保存期間の社内規程確定
→ 意思決定が必要

MVP（フェーズ1）— DTMF＋録音＋ルール＋Web管理

やる

ルールエンジン（番号/パターン、優先順位、拒否/居留守/アナウンス/IVR/通常着信）

DTMF IVR（基本メニュー、タイムアウト、転送、原則録音）

通話履歴＋録音管理（再生、DL、検索、タグ、メモ）

Web管理（ルール、リスト、音源、IVRツリー簡易、監査ログ、RBAC）

重要顧客通知（ブラウザ＋メール）

後回し

Slack通知、TTS、CRM同期、外部迷惑番号DB、自動スコアリング

やらない（当面）

偽装番号を完全に防ぐ（番号だけでは不可能な領域）

フェーズ2（拡張）

音声認識ルーティング（ASR/NLU）＋誤判定フォールバック（DTMF）

IVRフローの高度化（営業時間・担当割当・A/B）

迷惑電話の自動判定（外部DB/スコアリング）

レポート強化（迷惑電話傾向、応対率）

フェーズ3（運用最適化）

CRM連携（重要顧客自動更新）、ソフトフォン統合

保全機能強化（WORM、法務保全、電子署名相当）

要確認事項リスト（優先度つき）
最優先（P0：決まらないと設計が止まる）

回線取り込み方式（SIP連携可否、PBX/ゲートウェイ）

現IVRの構成と置き換え/共存方針

録音告知の必須要件（法務/社内規程）

同時通話数・ピーク呼量

録音の保存期間・保管場所（クラウド可否）

重要（P1：MVPの仕様がブレる）

重要顧客の定義（ホワイトリスト運用か、CRMか）

非通知/海外番号の基本方針

居留守の挙動（呼出し継続/無音/アナウンス）

通話の最終着地点（固定電話/転送/通知のみ）

権限設計（誰がDLできるか、監査要件）

後回し可（P2：拡張で良い）

音声認識の導入時期

外部迷惑番号DB・スコアリング

Slack通知やTTS

CRM連携
```



ChatGPTへの指示

```
ユースケースに展開してください
```

以下、ChatGPTによるユースケース分析
```
ユースケース一覧（MVP）
UC-01 着信を番号別ルールで判定する（共通前提）

目的：着信ごとに「拒否/居留守/アナウンス/IVR/通常着信」を自動決定する
主アクター：システム
トリガー：ひかり電話に着信が入る
事前条件：ルールが有効化されている、番号正規化設定がある
基本フロー

システムは発信者番号を取得（非通知の場合は匿名扱い）

電話番号を正規化（国番号・ハイフン除去等）

ルールを優先順位順に評価し、最初にマッチしたルールを採用

営業時間/休日条件があれば分岐

採用したアクションを実行（UC-02〜06へ遷移）

CallLog を生成し、適用ルールID/結果を保存
代替フロー

A1：番号が取得できない→匿名ルールへ

A2：複数ルールが競合→優先順位＋タイブレーク規約で決定
事後条件：通話結果が履歴に残る（拒否でも記録）
備考：このUCはすべての着信処理UCの共通ステップ

UC-02 迷惑電話を拒否する（切断）

主アクター：システム（Callerは結果を受ける）
トリガー：UC-01でアクション=拒否
基本フロー

システムは着信を即時切断

CallLogに result=rejected を保存
代替

A1：切断制御できない→アナウンス→切断（UC-04）へフォールバック
事後条件：オペレータへ着信通知は行わない

UC-03 迷惑電話を居留守にする（鳴らさない）

主アクター：システム
トリガー：UC-01でアクション=居留守
基本フロー

システムは内部の鳴動（人への通知）を抑止

発信者側へは呼出し中状態（リングバック）を返し、一定時間後にタイムアウト終了

CallLogに result=silent を保存（duration含む）
代替

A1：リングバック制御不可→無音応答 or アナウンス→切断へ切替（意思決定が必要）
事後条件：人が応対しない

UC-04 迷惑電話へアナウンスを流して切断する

主アクター：システム
トリガー：UC-01でアクション=アナウンス再生→切断
基本フロー

システムは自動応答し、指定アナウンス音源を再生

再生完了後に切断

CallLogに result=announced を保存（使用音源ID含む）
代替

A1：音源取得失敗→デフォルト音源で再生 or 即時切断（要件で選択）
事後条件：人が応対しない／発信者に明確なメッセージ

UC-05 コールセンター向けIVRへ接続しDTMFで振り分ける

主アクター：Caller、システム
トリガー：UC-01でアクション=IVR
事前条件：IVRフローが有効化され、音源/分岐/転送先が設定済み
基本フロー

システムがIVR開始音声を再生

CallerがDTMF入力

入力に応じた分岐ノードへ遷移

必要に応じて追加案内/再入力

最終的に「担当へ転送」または「自動応答で完了」または「切断」

IVR経路（ivr_path）をCallLogへ保存
代替

A1：無入力タイムアウト→再案内→最終的にオペ接続 or 切断

A2：不正入力→再案内

A3：転送先が話中/不達→別転送先 or 留守案内（要件選択）
事後条件：必要な問い合わせのみ人へ、不要は自動完結

UC-06 重要顧客は通常着信（鳴動）させる

主アクター：Caller、Operator、システム
トリガー：UC-01でアクション=通常着信
基本フロー

システムが電話機/オペレータ端末へ鳴動させる

Operatorが応答（または不在）

応答/不応答結果をCallLogへ保存

重要顧客の場合、通知を発火（UC-10）
代替

A1：営業時間外→営業時間外アナウンス→切断（またはIVRへ）
事後条件：重要顧客対応が可能

UC-07 通話を録音する（録音告知含む）

主アクター：システム（Operator/Callerは影響を受ける）
トリガー：ルールで record_enabled=true の通話が開始
基本フロー

（設定に応じて）録音告知アナウンスを再生（通話開始前 or 開始直後）

録音を開始し、録音メタ情報（開始時刻、通話ID）を生成

通話終了で録音停止、ファイル保存（ストレージへアップロード）

録音のハッシュ（checksum）を計算しRecordingに保存

CallLogへ recording_id を紐づけ
代替

A1：ストレージ障害→再試行、失敗時 recording_failed をCallLogに記録しアラート

A2：告知音源がない→デフォルト告知 or 告知なし（要件選択）
事後条件：再生/検索できる通話証跡が残る

UC-08 発着信履歴を閲覧・検索する

主アクター：Operator、Admin、Auditor
トリガー：ユーザーがWebで履歴画面を開く
基本フロー

ユーザーが期間、番号、結果種別、録音有無、タグ等で検索

システムがCallLog一覧を返す

詳細を開くと適用ルール、IVR経路、結果、録音リンクを表示
代替

A1：権限不足→録音リンク非表示、DL不可等の制御
事後条件：必要な通話を追跡できる

UC-09 録音を再生・タグ付け・（権限により）ダウンロードする

主アクター：Operator、Auditor、Admin
トリガー：履歴から録音を開く
基本フロー

システムが短期ストリーミングURLを発行し再生

ユーザーがタグ/メモを付与

DL要求があれば権限チェック→許可なら短期DL URL発行

再生/DL/編集の操作をAuditLogに記録
代替

A1：監査ロールはDL不可→再生のみ許可

A2：録音が存在しない/失敗→理由を表示（recording_failed等）
事後条件：証跡運用が回る（監査可能）

UC-10 重要顧客着信を通知する

主アクター：システム、Operator
トリガー：重要顧客ルールにマッチした着信（応答前/後は要件で選択）
基本フロー

ブラウザ通知（＋メール通知）を送信

通知には番号、名前（登録済みなら）、時刻、履歴リンクを含める

通知イベントをAudit/CallLogに記録
代替

A1：通知失敗→再試行、失敗ログ
事後条件：取り逃しが減る

UC-11 ルールを作成・編集・優先順位調整する

主アクター：Admin
トリガー：Webでルール管理を操作
基本フロー

Adminがパターン、アクション、録音/告知、営業時間分岐等を入力

「適用テスト」で番号を入力→当たるルールと結果を確認

保存→即時反映

変更内容をAuditLogにdiffとして記録
代替

A1：無効な正規表現→バリデーションエラー

A2：優先順位競合→システムが再採番 or ユーザーに調整UI提示
事後条件：運用者が自走できる

UC-12 ブラック/ホワイトリストを管理する

主アクター：Admin（場合によりOperatorも可）
基本フロー

番号を登録（名前/カテゴリ/メモ/タグ）

即時反映し、以後の着信に適用

変更は監査ログに記録
代替

A1：重複登録→マージ or エラー（方針選択）
事後条件：迷惑/重要の運用が簡単になる

UC-13 アナウンス音源を管理する

主アクター：Admin
基本フロー

音源アップロード（用途=営業お断り/録音告知/営業時間外など）

再生確認、名称付与

ルール/IVRノードに割り当て

監査ログ記録
代替

A1：形式不正/長すぎる→変換要求 or 拒否
事後条件：音源運用が可能

UC-14 IVRフローを編集・有効化する

主アクター：Admin
基本フロー

ノード（再生/メニュー/転送/切断）を編集

プレビュー（ツリー表示）

変更をドラフト保存→有効化

バージョン管理（activeは1つ）

監査ログ記録
代替

A1：参照音源が削除済み→有効化不可
事後条件：IVRを変更できる

UC-15 監査ログを閲覧・エクスポートする

主アクター：Auditor、Admin
基本フロー

条件（期間、ユーザー、アクション、対象）で検索

一覧/詳細を閲覧

権限があればエクスポート
事後条件：内部統制・証跡追跡が可能

ユースケース一覧（拡張：フェーズ2以降）
UC-16 音声認識でIVRを自動振り分けする（将来）

目的：DTMF不要で意図分類→担当へ

フォールバック：誤判定/低信頼度はDTMFメニューへ

UC-17 迷惑電話を自動スコアリングしてルール提案する（将来）

目的：迷惑候補を提示し、ワンクリックでブラック化

UC-18 CRM連携で重要顧客を自動同期する（将来）
```

## IEEE標準フォーマットに変換
要求仕様書のフォーマットは統一されていることが望ましいため、企業独自のフォーマットが規定されていることが多い。例としてIEEEフォーマットにするように指示を出す。
```
この要求仕様、ユースケースをIEEE標準フォーマットに出力してください。
```
IEEE標準のSRS（Software Requirements Specification）フォーマット(ここではIEEE830構成を採用している)
```
Software Requirements Specification (SRS)
「番号別着信制御・IVR・録音・Web管理システム」
文書情報

文書種別：SRS（要求仕様書）

対象：ひかり電話着信の番号別制御、IVR、録音、Web管理

版：Draft 0.1（仮置き含む）

1. Introduction（序論）
1.1 Purpose（目的）

本SRSは、ひかり電話への着信を電話番号等の条件で判定し、迷惑電話の自動排除、コールセンター向けIVR対応、重要顧客への優先着信、ならびに通話録音と履歴管理をWebブラウザで運用可能にするシステムの要求仕様を定義する。

1.2 Scope（範囲）

本システムは以下を提供する：

番号別ルールに基づく着信制御（拒否／居留守／アナウンス／IVR／通常着信）

DTMFベースIVR（将来、音声認識へ拡張可能）

録音（告知アナウンス含む）、履歴、検索、監査ログ

Web管理（ルール/リスト/IVR/音源/履歴/録音/権限）

1.3 Definitions, Acronyms, Abbreviations（用語）

IVR：Interactive Voice Response（自動音声応答）

DTMF：Dual-Tone Multi-Frequency（プッシュ入力）

RBAC：Role-Based Access Control（役割ベースアクセス制御）

CallLog：通話履歴レコード

Recording：録音ファイルおよびメタ情報

Announcement：再生する音声（告知、営業時間外、営業お断り等）

ひかり電話：NTT系IP電話サービス（提供形態により接続方式が変わり得る）

1.4 References（参照）

（社内規程）録音の告知要件、保存期間、開示・削除要件（未確定）

（回線情報）ひかり電話の接続・SIP可否、既存IVR構成（未確定）

1.5 Overview（概要）

本書は、全体像（第2章）と個別要求（第3章）を定義し、ユースケースは機能要求として記述する。

2. Overall Description（全体記述）
2.1 Product Perspective（製品の位置づけ）

本システムは、電話ネットワーク（ひかり電話）と通話制御基盤（PBX/IVR/録音）およびWeb管理UIから構成される。
※ひかり電話の提供形態・SIP連携可否により実装アーキテクチャが変動するため、接続方式は第3章の前提確認事項で確定する。

2.2 Product Functions（主要機能）

F1：着信時の番号正規化・ルール評価・アクション実行

F2：迷惑電話の拒否/居留守/アナウンス

F3：IVR（DTMF）による自動振り分けと転送

F4：通話録音（告知あり/なし、ルール単位設定）

F5：通話履歴・録音の検索/再生/（権限により）ダウンロード

F6：Webでのルール/IVR/音源/リスト/権限/監査の管理

F7：重要顧客着信の通知（最低限：ブラウザ/メール）

2.3 User Classes and Characteristics（ユーザー種別）

Admin：ルール/IVR/音源/権限/保持設定の管理者

Operator：履歴参照、録音再生、応対の実務担当

Auditor：監査ログと証跡の閲覧（DL制限などがあり得る）

2.4 Operating Environment（運用環境）

Webブラウザ（管理UI）

通話制御基盤（PBX/IVR/録音、もしくは同等機能）

録音保管ストレージ（クラウド/オンプレは要決定）

ネットワーク（社内/インターネット）

2.5 Design and Implementation Constraints（制約）

ひかり電話の接続方式（SIP可否、ゲートウェイ/PBX要否）が制約となる

録音告知・保存期間・開示/削除は法務/社内規程に従う必要がある

番号偽装（スプーフィング）は番号ベース制御のみでは完全防止できない

2.6 Assumptions and Dependencies（前提と依存）

発信者番号を取得できること（非通知は匿名扱い）

IVR/録音機能を実現する通話制御基盤が利用可能であること

Web管理者がルール運用を行う体制があること

3. Specific Requirements（個別要求）

以下は識別子（REQ-xxx）で管理する。
「MVP対象」か「将来拡張」かを明示する。

3.1 External Interface Requirements（外部インタフェース）
3.1.1 Telephony Interface（電話IF）

REQ-IF-001（MVP）：着信イベントを取得し、発信者番号（可能ならE.164相当へ正規化）を扱えること

REQ-IF-002（MVP）：着信の通話制御（応答、切断、転送、音声再生、DTMF検出、録音開始/停止）が可能であること

REQ-IF-003（要決定）：ひかり電話との接続方式（SIP trunk / ゲートウェイ / その他）を確定すること

3.1.2 Web UI Interface（Web管理IF）

REQ-IF-101（MVP）：ルール/履歴/録音/IVR/音源/監査/権限をブラウザで操作できること

REQ-IF-102（MVP）：権限により画面/操作（録音DLなど）を制限できること

3.1.3 Storage Interface（保存IF）

REQ-IF-201（MVP）：録音ファイルとメタデータを保存できること（暗号化・保持期限を扱えること）

REQ-IF-202（MVP）：録音のストリーミング再生と、権限に応じたダウンロード（短期URL等）が可能であること

3.2 Functional Requirements（機能要求）
3.2.1 ルールエンジン（番号別判定）

REQ-FN-001（MVP）：着信時に発信者番号を正規化し、ルールを優先順位順に評価して最初にマッチしたルールを適用すること

REQ-FN-002（MVP）：番号マッチ方式として、完全一致/部分一致/正規表現/匿名（非通知）/国番号条件をサポートすること

REQ-FN-003（MVP）：フォールバック（既定）ルールを持つこと

REQ-FN-004（MVP）：営業時間/休日カレンダー条件で分岐できること

REQ-FN-005（MVP）：同一番号の連続着信抑制（一定時間内の追加着信を強めのアクションへ）を設定できること

3.2.2 アクション（拒否／居留守／アナウンス／IVR／通常着信）

REQ-FN-010（MVP）：アクション種別として以下を提供すること

拒否（切断）

居留守（内部鳴動なし＋タイムアウト終了）

アナウンス再生後切断

IVRへ接続（DTMF）

通常着信（鳴動）

通常着信＋録音

REQ-FN-011（MVP）：アクション実行結果を通話履歴に記録すること

3.2.3 IVR（DTMF）

REQ-FN-020（MVP）：DTMF入力によるメニュー分岐（例：1/2/3）を提供すること

REQ-FN-021（MVP）：無入力タイムアウト、再案内、不正入力時の再案内、最終分岐（転送/切断）を提供すること

REQ-FN-022（MVP）：IVR経路（ノード遷移）を通話履歴へ保存すること

REQ-FN-023（拡張）：将来、音声認識による意図分類ルーティングを追加し、低信頼度時はDTMFへフォールバックすること

3.2.4 録音（告知含む）

REQ-FN-030（MVP）：ルール単位で録音ON/OFFを設定できること

REQ-FN-031（MVP）：録音告知アナウンスON/OFFをルール単位で設定できること（告知のタイミングも設定可能とする）

REQ-FN-032（MVP）：録音ファイルの整合性確認のためハッシュ（例：SHA-256）をメタ情報として保持すること

REQ-FN-033（MVP）：録音失敗時は履歴に失敗理由を記録し、運用者が検知できること

3.2.5 履歴・検索・監査

REQ-FN-040（MVP）：発着信履歴を保存すること（日時、番号、結果、通話時間、適用ルール、録音有無、IVR経路、転送先等）

REQ-FN-041（MVP）：番号/期間/結果/録音有無/タグ等で検索できること

REQ-FN-042（MVP）：録音の再生、タグ、メモを提供すること

REQ-FN-043（MVP）：監査ログとして、少なくとも「ルール変更、録音再生、録音DL、録音削除、権限変更」を記録すること

REQ-FN-044（MVP）：監査ログを検索・エクスポートできること

3.2.6 Web管理（運用）

REQ-FN-050（MVP）：ルール一覧/作成/編集/有効化/無効化/優先順位変更を提供すること

REQ-FN-051（MVP）：番号を入力して「適用されるルールと実行アクション」を確認できるテスト機能を提供すること

REQ-FN-052（MVP）：ブラック/ホワイトリスト管理を提供すること

REQ-FN-053（MVP）：アナウンス音源のアップロード/再生確認/割当を提供すること

REQ-FN-054（MVP）：IVRフロー（簡易ツリー）の編集と有効化（バージョン）を提供すること

REQ-FN-055（MVP）：RBAC（Admin/Operator/Auditor）を提供すること

3.2.7 通知

REQ-FN-060（MVP）：重要顧客ルールに該当する着信について通知を送信できること（最低：ブラウザ内＋メール）

REQ-FN-061（拡張）：Slack等の外部通知を追加できること

REQ-FN-062（拡張）：迷惑電話ランキング等の定期レポートを提供できること

3.3 Use Case Requirements（ユースケース要求）

IEEE 830ではユースケースを「機能要求の記述形式」として含めることが多いため、主要UCを標準テンプレ（目的/前提/基本/代替/事後）で記載する。

UC-01 着信を番号別ルールで判定する

目的：着信ごとに適切なアクションを選択する

アクター：システム

トリガー：着信イベント

前提：有効ルールが存在、番号正規化が可能

基本フロー：番号取得→正規化→優先順位評価→マッチ→営業時間分岐→アクション実行→履歴保存

代替：非通知→匿名ルール、競合→タイブレーク、番号不正→既定ルール

事後：CallLog生成、適用ルールと結果が保存される

UC-02 迷惑電話を拒否する（切断）

目的：迷惑電話に人が出ない

トリガー：アクション=拒否

基本：即時切断→履歴保存（rejected）

代替：切断制御不可→UC-04へフォールバック

事後：人への通知なし

UC-03 迷惑電話を居留守にする（鳴らさない）

目的：内部鳴動なしで発信者に呼出し状態を継続させ、時間で終わらせる

トリガー：アクション=居留守

基本：内部通知抑止→リングバック継続→タイムアウト→履歴保存（silent）

代替：リングバック制御不可→方式選択（無音応答/アナウンス）

事後：人が応対しない

UC-04 アナウンスを流して切断する

目的：営業お断り等を明確化しつつ切断する

基本：自動応答→音源再生→切断→履歴保存（announced）

代替：音源取得失敗→デフォルト音源 or 切断

事後：人が応対しない

UC-05 IVRへ接続しDTMFで振り分ける

目的：一次受付を自動化し、必要時のみ人へ接続する

アクター：Caller、システム

基本：開始音声→DTMF入力→分岐→転送/完了/切断→IVR経路保存

代替：無入力→再案内→最終転送/切断、不正入力→再案内、転送不達→代替転送/案内

事後：CallLogにivr_pathが残る

UC-06 重要顧客は通常着信（鳴動）させる

目的：重要顧客の取り逃しを防ぐ

基本：鳴動→応答/不応答→履歴保存→必要なら通知（UC-10）

代替：営業時間外→営業時間外動作へ（アナウンス/IVR等）

事後：重要顧客が適切に扱われる

UC-07 通話を録音する（告知含む）

目的：通話証跡の確実な保存

基本：告知（設定時）→録音開始→通話終了→保存→ハッシュ生成→履歴紐付け

代替：保存失敗→再試行→失敗記録＆アラート

事後：録音が検索/再生可能

UC-08 履歴を検索・閲覧する

目的：過去の通話を追跡し対応状況を把握

基本：条件入力→一覧→詳細（適用ルール、結果、録音リンク）

代替：権限不足→録音非表示等

事後：必要情報に到達できる

UC-09 録音を再生・タグ付け・（権限により）DLする

目的：証跡の確認・共有・保全

基本：再生→タグ/メモ→DL（許可時）→監査ログ

代替：DL不可ロール→再生のみ

事後：操作証跡（AuditLog）が残る

UC-10 重要顧客着信を通知する

目的：気づき漏れの防止

基本：通知送信（ブラウザ/メール）→履歴リンク提示→通知ログ

代替：通知失敗→再試行→失敗ログ

事後：取り逃しを減らす

UC-11 ルールを作成・編集・優先順位調整する

目的：運用で自走できる

基本：入力→適用テスト→保存→即反映→監査ログ

代替：正規表現不正→エラー、競合→再採番or調整UI

事後：安全に変更できる

UC-12 リスト（ブラック/ホワイト）を管理する

基本：登録→即反映→監査ログ

代替：重複→マージor拒否（方針要決定）

UC-13 音源（アナウンス）を管理する

基本：アップロード→再生確認→割当→監査ログ

代替：形式不正→拒否/変換

UC-14 IVRフローを編集・有効化する

基本：編集→ドラフト保存→有効化（activeは1つ）→監査ログ

代替：参照音源欠落→有効化不可

UC-15 監査ログを閲覧・エクスポートする

基本：検索→閲覧→（権限により）エクスポート

3.4 Nonfunctional Requirements（非機能要求）
3.4.1 Performance（性能）

REQ-NF-001（MVP）：履歴検索結果の表示はP95で10秒以内

REQ-NF-002（MVP）：録音再生開始はP95で10秒以内

REQ-NF-003（要決定）：同時通話数（例：2〜5）に対応（数値確定が必要）

3.4.2 Availability（可用性）

REQ-NF-010（MVP）：営業時間中の停止許容範囲（RTO/RPO）を定義し、それを満たす運用を行う（数値要決定）

REQ-NF-011（拡張）：冗長化（PBX/ストレージ/DB）を段階導入できる

3.4.3 Security（セキュリティ）

REQ-NF-020（MVP）：RBACにより操作（録音DL、削除、ルール変更）を制御する

REQ-NF-021（MVP）：録音・メタデータは保存時暗号化、通信はTLSを使用する

REQ-NF-022（MVP）：監査ログを改ざん困難な形で保全する（少なくとも追記型・削除ログ必須）

REQ-NF-023（拡張）：SSO（SAML/OIDC等）を導入可能にする

3.4.4 Compliance & Privacy（コンプライアンス）

REQ-NF-030（MVP）：録音告知の要件（必須/任意、文言、タイミング）を社内規程に従い実装する（要決定）

REQ-NF-031（MVP）：保存期間、削除、開示要求の運用フローを定義しシステムで支援する（要決定）

3.4.5 Maintainability & Operability（保守運用）

REQ-NF-040（MVP）：録音保存失敗、通話制御失敗等は運用者が検知できる（ダッシュボード/アラート）

REQ-NF-041（MVP）：ルール変更は即反映され、変更履歴が残る

REQ-NF-042（MVP）：バックアップ方針を定義し実施できる（要決定）

3.5 Data Requirements（データ要求：概略）

REQ-DATA-001（MVP）：Rule, PhoneNumberPattern, CallLog, Recording, Announcement, IVRFlow/Node, AuditLog, UserRole を保持する

REQ-DATA-002（MVP）：CallLogは適用ルール・結果・IVR経路・録音紐付けを持つ

REQ-DATA-003（MVP）：Recordingはハッシュ、保持期限、暗号化情報を持つ

4. Appendices（付録）
4.1 MVP/フェーズ計画（要約）

MVP：DTMF IVR＋録音＋ルール＋Web管理＋監査＋重要顧客通知

フェーズ2：音声認識、外部DB/スコアリング、通知拡張、CRM連携

4.2 Open Issues（未解決事項：P0）

ひかり電話の接続方式（SIP可否、ゲートウェイ/PBX）

現IVRとの共存/置換方針

録音告知の法務・社内規程、保存期間、開示/削除手順

同時通話数・ピーク呼量

録音保管先（クラウド/オンプレ）と暗号化・鍵管理
```

## ユースケースの検証と具体化
- REBOKにおける「要求の検証・妥当性の確認・評価」に対応するプロンプトを作成する。
```
あなたは「ブラウザ管理、閲覧をするユーザー」です。「ブラウザを管理、閲覧するユーザーのユースケース」において不足している点、留意すべき点を上げてください。また、「その理由と根拠」も示してください。
```


```
1) ブラウザ利用者のユースケースで不足している点
1. 権限設計が「閲覧可/不可」以上に分解されていない

不足

録音の権限が「再生」「DL」「共有リンク発行」「削除」「保持期限延長（リーガルホールド）」「メタ編集（タグ/メモ）」「マスキング」まで分かれていない

履歴の権限も「閲覧」「エクスポート」「番号編集（名寄せ）」「ルール変更」などが未整理

理由・根拠

“録音DL”は情報漏えいリスクの最大ポイントで、監査・内部統制上「再生は可でもDL不可」の分離が現場で必須になりがちです。

運用では「オペレータはメモ付けしたいが、削除は管理者のみ」など、職務分掌が必要になります。

2. 「運用フロー（誰が・いつ・どう判断して・どう更新するか）」がユースケースに落ちていない

不足

迷惑電話が来た後の定型運用（例：履歴確認→ワンクリックでブラック登録→次回から拒否）

重要顧客の番号変更・追加の運用（誰が承認するか）

ルール変更の“レビュー/承認”ワークフロー（四眼原則）

理由・根拠

電話運用は“現場の改善”が頻繁に発生し、管理UIの価値は 「改善が速い」 ことにあります。

ルール変更は誤ると「重要顧客を拒否」等の事故になるため、承認/差分確認が必要になりやすいです。

3. 変更の安全性（プレビュー/検証/ロールバック）が弱い

不足

ルール変更の差分表示（diff）

変更の影響範囲（どの番号帯に効くか）の可視化

ワンクリック・ロールバック（前バージョンへ戻す）

サンドボックス（テスト環境）や“予定適用（予約）”の検討

理由・根拠

実運用では「ちょっとした編集」が重大事故（誤拒否・誤IVR）につながるため、変更管理が事故率を左右します。

“戻せる”ことが運用心理的安全性とSLAに直結します。

4. 録音の“証拠能力”を支えるユースケースが不足

不足

録音の改ざん防止運用（ハッシュはあるが、表示・検証・監査証跡の流れがない）

“リーガルホールド（削除禁止）”と保持延長

エクスポート時の「メタ情報（通話日時、番号、適用ルール、ハッシュ）」同梱

理由・根拠

「言った言わない」対策が主目的なら、録音単体より “いつ誰が扱ったか” と “改ざんされていないこと” が重要になります。

監査・紛争時に“保全”ができないと、録音があっても運用上使いづらいです。

5. 個人情報・プライバシー対応（開示/削除/マスキング）がユースケース化されていない

不足

開示請求や削除依頼を受けた際の処理フロー

録音の部分マスキング（必要なら）

保存期間到来の自動削除と、その例外（保全）

理由・根拠

録音・番号・会話内容は個人情報を含み得るため、保存期間と削除・開示は運用上必ず論点になります。

「削除はしたが監査ログは残す」などの設計が必要です。

6. 検索・発見性が運用要件として弱い

不足

“困った時にすぐ辿り着く”ための検索キーが未確定

例：相手番号の揺れ（050/0ABJ/国番号）、非通知扱い、タグ、担当、IVR経路、アナウンス種別、録音失敗、連続着信

迷惑電話の“パターン探索”用の分析（時間帯、回数、番号帯、上位ランキング）

理由・根拠

運用の成否は「探せるか」に依存します。録音があっても検索できないと意味が薄い。

迷惑電話対策は“検出→登録→効果測定”のループが必要です。

7. 通知の「見落とし防止」設計が不足

不足

通知の重複抑制（同一番号の短時間連続通知）

重要顧客通知のエスカレーション（未応答時に再通知、別宛先へ）

通知の「既読」「対応中」状態管理

理由・根拠

“取りこぼし防止”が目的なら、通知は「飛ばす」だけでなく「確実に気づかせる」設計が必要です。

通知が多すぎるとアラート疲れで重要通知が埋もれます。

8. 「番号の正規化・名寄せ」をUIで扱うユースケースが不足

不足

表記ゆれ（ハイフン、国番号、0発信、転送表示）を統一して扱う

同一相手の複数番号（代表/部署/携帯）を“顧客”として束ねる（将来CRMがなくても最低限）

理由・根拠

番号ベース運用は “表記ゆれ” があるとルールが効かない/検索できない事故が起きます。

VIPの取り逃しを防ぐには、名寄せの概念が効きます。

9. Web運用のセキュリティ（セッション/端末/持ち出し）ユースケースが不足

不足

2FA、SSO、IP制限、端末制限、セッションタイムアウト

録音DLのウォーターマーク、アクセス期限付きリンク、ダウンロード履歴の可視化

理由・根拠

録音ファイルは漏えいインパクトが大きいので、Webの認証・セッション管理が重要になります。

“誰がいつDLしたか”はトラブル時の一次情報になります。

10. アクセシビリティ/操作性（現場で使えるUI）観点が不足

不足

ショートカット、一覧→詳細→戻るの高速導線

音声再生の操作性（倍速、頭出し、ノイズ、波形表示は任意だが検討）

モバイル閲覧の要否（重要顧客通知でスマホを見る可能性）

理由・根拠

コールセンター運用は“秒単位の手間”が積み重なるため、UI導線がコストに直結します。

録音は「必要部分を素早く聞けるか」が最重要です。

2) 留意すべき点（設計判断が必要なポイント）
A. 「居留守」の期待動作は、電話基盤の制約で変わる（意思決定が必要）

留意点：無音応答・呼出し継続・疑似リングバックのどれが可能か
理由・根拠：ひかり電話/ゲートウェイ/PBXの制御範囲に依存し、UI要件にも影響する（設定として提供できるか）

B. 迷惑電話の“突破”をどこまで想定するか（期待値管理）

留意点：番号偽装/番号変えを前提にするか、どの対策をMVPに入れるか
理由・根拠：番号ベースだけでは限界があるため、運用ループ（連続着信抑制/アナウンス強化）で実害を減らす設計が現実的

C. 録音告知の統一方針（全通話/一部通話）と文言

留意点：顧客体験と法務要件のバランス
理由・根拠：告知を入れるとクレーム抑止になる一方、問い合わせ体験を損ねる場合もあり、ルール単位で制御する価値がある
```

これらを要求仕様に反映させる必要がある。以下の通りプロンプトを与える。
```
上記を「ブラウザ管理、閲覧をするユーザー」として反映してください
```
```
追補SRS：ブラウザ管理・閲覧ユーザー要件（反映版）
2.3 User Classes（ブラウザ利用者の定義：更新）

Admin（管理者）

ルール/IVR/音源/保持/権限の管理責任

事故防止のため「レビュー・承認・ロールバック」が必要

Operator（運用者）

履歴追跡、録音確認、迷惑電話の登録、重要顧客の見落とし防止

Auditor（監査者）

監査ログ閲覧、録音閲覧（通常DL不可）、証跡保全の確認

3.2 Functional Requirements（機能要求：追加・強化）
3.2.6 Web管理（運用）— 強化（既存REQ-FN-050〜055に追加）

REQ-FN-056（MVP）：ルール変更時に差分（diff）を表示し、変更理由（任意）を入力できること

REQ-FN-057（MVP）：ルール/IVRのバージョン管理とロールバック（直前版へ戻す）を提供すること

REQ-FN-058（MVP）：ルール適用テストは「マッチした理由（どのパターンに一致したか）」を表示すること

REQ-FN-059（MVP）：変更履歴（誰が・いつ・何を）を対象（Rule/IVR/Announcement/Role）単位で参照できること

REQ-FN-059a（拡張）：ルール変更に承認フロー（四眼原則：作成者≠承認者）を追加できること

根拠（運用・事故防止）：誤変更で重要顧客を拒否する等の事故が起き得るため、差分確認とロールバックが必須。

3.2.5 履歴・検索・監査 — 強化（既存REQ-FN-040〜044に追加）

REQ-FN-045（MVP）：検索条件として以下をサポートすること

番号（正規化後/原文）、期間、結果、録音有無、タグ、IVR経路、録音失敗、連続着信フラグ

REQ-FN-046（MVP）：履歴詳細に「適用ルール」「タイムライン（イベント）」を表示すること（応答/転送/録音開始/停止など）

REQ-FN-047（MVP）：履歴からワンクリックでブラック/ホワイト登録できること（UC-19）

REQ-FN-048（MVP）：履歴・録音・監査ログのエクスポートは権限で制御できること（AuditorはDL不可など）

根拠（発見性・運用速度）：現場運用は「探す→判断→登録」が頻繁であり、ワンクリック化で迷惑電話対応コストを下げられる。

3.2.4 録音（告知含む）— 強化（既存REQ-FN-030〜033に追加）

REQ-FN-034（MVP）：録音操作権限を分割できること（再生/DL/共有/削除/保持延長/メタ編集）

REQ-FN-035（MVP）：録音の保持期限（retention_until）を表示し、管理者は延長（リーガルホールド）できること（UC-21）

REQ-FN-036（MVP）：録音DL時はメタ情報（日時、番号、適用ルール、ハッシュ）を同梱できること（ZIP/JSON等）

REQ-FN-037（拡張）：録音共有リンク（期限付き・アクセス制御付き）を提供できること

根拠（証跡・内部統制）：録音を“証拠”として扱うなら、改ざん検知・保全・誰が扱ったかの追跡が必要。

3.2.7 通知 — 強化（既存REQ-FN-060に追加）

REQ-FN-063（MVP）：重要顧客通知に「既読/未読」「対応中」ステータスを持たせること

REQ-FN-064（MVP）：同一番号の短時間連続通知は抑制できること（アラート疲れ防止）

REQ-FN-065（拡張）：未応答が一定時間続く場合のエスカレーション通知（別担当/別チャネル）を提供できること

根拠（取り逃し防止）：通知は“送るだけ”ではなく“見落としを防ぐ制御”が必要。

3.2.8 番号正規化・名寄せ（新規）

REQ-FN-070（MVP）：番号を正規化して保存・検索できること（ハイフン除去、国番号、先頭0等の規約を定義）

REQ-FN-071（拡張）：複数番号を1つの「連絡先/顧客」として名寄せできること（CRMなしでも最低限）

根拠（ルール精度・検索性）：表記ゆれがあるとルールが効かない／履歴検索で漏れる事故が起きる。

3.2.9 Webセキュリティ（新規）

REQ-NF-024（MVP）：セッションタイムアウト、再認証（録音DLなど高リスク操作時）を実装すること

REQ-NF-025（拡張）：SSO/2FA/IP制限/端末制限を導入可能にすること

REQ-NF-026（拡張）：録音DLにウォーターマーク（ユーザーID/日時）を付与できること

根拠（漏えい対策）：録音の持ち出しが最大リスクのため、Web側の認証・操作制御が重要。

3.3 Use Case Requirements（ユースケース：ブラウザ管理・閲覧者向けに更新/追加）
UC-08（更新）履歴を検索・閲覧する

追加要件：

ルール適用理由、イベントタイムライン、録音失敗の原因表示

検索条件にIVR経路・連続着信を含める（REQ-FN-045/046）

UC-09（更新）録音を再生・タグ付け・DLする（権限分割）

追加要件：

権限分割（再生/DL/削除/保持延長/メタ編集）

DL時にメタ情報同梱、監査ログ強制記録（REQ-FN-034/036）

UC-10（更新）重要顧客着信を通知する（見落とし防止）

追加要件：

既読/対応中、連続通知抑制、（拡張で）エスカレーション（REQ-FN-063/064/065）

UC-11（更新）ルール作成・編集・優先順位調整（安全運用）

追加要件：

diff表示、理由入力、ロールバック、適用テストで“マッチ理由”表示（REQ-FN-056/057/058）

UC-15（更新）監査ログを閲覧・エクスポート

追加要件：

監査ログは対象別（Rule/Recording/Role）に追える

エクスポート権限を制御（REQ-FN-048/059）

新規ユースケース（ブラウザ運用の肝）
UC-19 履歴から迷惑電話を即ブラック登録する（ワンクリック）

アクター：Operator/Admin

目的：迷惑電話対策の運用ループを高速化

基本：履歴→「迷惑」→ブラック登録→確認→次回から拒否/アナウンスへ

事後：登録と操作は監査ログに残る

紐付け：REQ-FN-047

UC-20 ルール変更を差分確認しロールバックする

アクター：Admin

目的：誤設定事故を防止

基本：編集→diff確認→保存→問題発生時に前版へ戻す

代替：承認フロー（拡張）

紐付け：REQ-FN-056/057/059a

UC-21 録音をリーガルホールドし保持期限を延長する

アクター：Admin（Auditorは要求のみ等、運用で決定）

目的：紛争/監査時に削除されないよう保全

基本：録音詳細→保持延長/保全フラグ→理由入力→監査ログ

紐付け：REQ-FN-035

UC-22 開示・削除要求に対応する（証跡を残す）

アクター：Admin/Auditor

目的：コンプライアンス対応

基本：対象特定→エクスポート or 削除→削除ログ→例外（保全中は不可）

紐付け：REQ-NF-030/031、REQ-FN-043

UC-23 番号正規化ルールを管理し名寄せする（最低限）

アクター：Admin

目的：検索漏れ/ルール漏れを防ぐ

基本：正規化規約確認→適用→履歴/ルールの一致性を確保

紐付け：REQ-FN-070/071

UC-24 重要顧客通知の既読・対応中・重複抑制を運用する

アクター：Operator

目的：見落とし防止とアラート疲れ回避

基本：通知→既読→対応中→完了（履歴にリンク）

紐付け：REQ-FN-063/064

ブラウザ利用者としての留意点（要求に明示しておくべき“運用上の落とし穴”）

録音DLを誰に許すか：漏えいリスク最大 → 権限分割必須

ルール変更は事故リスク：diff/ロールバック/（可能なら承認）が必須

番号表記ゆれ：正規化がないと運用が破綻しやすい

通知は多いと死ぬ：抑制・既読・状態管理が必要

“証拠”として使うなら保全が要る：保持延長・メタ同梱・監査ログが要
```

最後にUMLのユースケース図を作成する。このタスクは、REBOKによる「要求仕様化」に対応する。
```
ユースケース図を作成してください。「PlantUML」の形式で出力してください。
```

以下の通りPlantUMLでUMLが作成される。
```
@startuml
' Use Case Diagram: Browser Management & Viewing Users
left to right direction
skinparam packageStyle rectangle
skinparam actorStyle awesome

' Actors
actor "Admin\n(管理者)" as Admin
actor "Operator\n(運用者)" as Operator
actor "Auditor\n(監査者)" as Auditor

' System boundary
rectangle "番号別着信制御・IVR・録音・Web管理システム\n(Web管理・閲覧領域)" as System {

  ' Core browsing / operations
  usecase "UC-08\n発着信履歴を検索・閲覧する" as UC08
  usecase "UC-09\n録音を再生・タグ付け・\n(権限により)DLする" as UC09
  usecase "UC-15\n監査ログを検索・閲覧・\n(権限により)エクスポートする" as UC15

  ' Notifications
  usecase "UC-10\n重要顧客着信を通知する" as UC10
  usecase "UC-24\n通知の既読/対応中管理・\n重複抑制を運用する" as UC24

  ' Rule / IVR / announcement management
  usecase "UC-11\nルールを作成・編集・\n優先順位調整する" as UC11
  usecase "UC-20\nルール変更の差分確認・\nロールバックを行う" as UC20

  usecase "UC-14\nIVRフローを編集・\n有効化する" as UC14
  usecase "UC-13\nアナウンス音源を\n管理する" as UC13

  usecase "UC-12\nブラック/ホワイトリストを\n管理する" as UC12
  usecase "UC-19\n履歴から迷惑電話を\n即ブラック登録する" as UC19

  ' Recording compliance / retention
  usecase "UC-21\n録音をリーガルホールドし\n保持期限を延長する" as UC21
  usecase "UC-22\n開示・削除要求に対応する\n(証跡を残す)" as UC22

  ' Normalization / identity
  usecase "UC-23\n番号正規化ルールを管理し\n名寄せする" as UC23

  ' Access control
  usecase "UC-25\nユーザー/権限(RBAC)を管理する" as UC25

  ' Included sub use cases (common)
  usecase "権限チェック\n(RBAC判定)" as RBAC
  usecase "監査ログ記録\n(操作証跡)" as AUDIT
  usecase "適用テスト\n(番号→処理結果/理由)" as TEST
  usecase "差分表示\n(変更diff)" as DIFF
  usecase "ロールバック\n(前版復元)" as ROLLBACK
  usecase "メタ同梱DL\n(録音+メタ情報)" as META_DL
}

' Associations: Admin
Admin --> UC08
Admin --> UC09
Admin --> UC10
Admin --> UC11
Admin --> UC12
Admin --> UC13
Admin --> UC14
Admin --> UC15
Admin --> UC20
Admin --> UC21
Admin --> UC22
Admin --> UC23
Admin --> UC25
Admin --> UC24

' Associations: Operator
Operator --> UC08
Operator --> UC09
Operator --> UC10
Operator --> UC12
Operator --> UC19
Operator --> UC24

' Associations: Auditor
Auditor --> UC08
Auditor --> UC09
Auditor --> UC15
Auditor --> UC21
Auditor --> UC22

' Includes / Extends
UC09 ..> RBAC : <<include>>
UC15 ..> RBAC : <<include>>
UC11 ..> RBAC : <<include>>
UC12 ..> RBAC : <<include>>
UC13 ..> RBAC : <<include>>
UC14 ..> RBAC : <<include>>
UC21 ..> RBAC : <<include>>
UC22 ..> RBAC : <<include>>
UC23 ..> RBAC : <<include>>
UC25 ..> RBAC : <<include>>

UC09 ..> AUDIT : <<include>>
UC11 ..> AUDIT : <<include>>
UC12 ..> AUDIT : <<include>>
UC13 ..> AUDIT : <<include>>
UC14 ..> AUDIT : <<include>>
UC15 ..> AUDIT : <<include>>
UC19 ..> AUDIT : <<include>>
UC20 ..> AUDIT : <<include>>
UC21 ..> AUDIT : <<include>>
UC22 ..> AUDIT : <<include>>
UC23 ..> AUDIT : <<include>>
UC25 ..> AUDIT : <<include>>

UC11 ..> TEST : <<include>>
UC20 ..> DIFF : <<include>>
UC20 ..> ROLLBACK : <<include>>

UC19 ..> UC08 : <<extend>>  ' from history view
UC24 ..> UC10 : <<extend>>  ' manages state for notifications

UC09 ..> META_DL : <<extend>> ' only if DL permitted and requested
UC22 ..> UC21 : <<extend>>    ' if legal hold active then deletion blocked (policy)

@enduml

```

## 生成AI適用時の留意点
出力結果を鵜呑みにせず有能なアシスタントとして利用に留めること。  
少なくとも現時点では最終的な要求の仕様化はシステムエンジニアの責任の下で確定させること。  
理由：今回の例で顧客要望が上手く仕様化できたのは、事前学習済みのデータを使用しているからである。  
一方、企業間の独自ノウハウが必要な場合、ファインチューニングを行って、生成AIモデルに企業独自の知識を学習させる必要がある。


# プロンプトパターンの効果的活用
## 逆質問パターン
```
本システムの開発は、電話応対窓口の作業を効率化することを目的としています。

（ユーザーからの要望）
これらの要望を実現するのにユーザーに確認したい事項を「私に質問してください」
```
## Nバージョン要求しようか

## データ駆動形ペルソナの自動生成

## 技術動向
生成などへの適用が進んでおり、研究事例も増え始めている。以下例を示す。
### 要求工学分野における旗艦国際会議の動向
(1 )要求工学の基礎、要求工学プロセス、要求獲得、要求分析  
- 模範的要求。
- インタビュー
- ペルソナ
- プロトタイプング
- 要求マッピング
- 要求工学教育

(2) 要求仕様化 
(3) 要求の検証・妥当性の確認・評価
- 要求間の矛盾検出
- 要求と設計・実装の一貫性チェック
- 要求のあいまいさ・不完全さの識別
- 形式手法の適用
(4) 要求の計画と管理
- 品質特性の強化
- 要求から設計・実装への流れ
## 書籍や記事の動向
## 体系的文献調査

 # 今後の展望
- 産学連携の深耕
- 要求工学プロセスにおける適用範囲の拡大
- AIエージェントによる要求工学の自動化
- 生成AIモデルから世界モデルへ