# STYLE (Project-wide)

このドキュメントは、本リポジトリ全体に共通する「書き方・作り方」の基準（正本）です。  
言語固有の細則は `docs/style/*` に分離します。

- Rust: docs/style/rust.md
- C/C++: docs/style/c.md
- Python: docs/style/python.md

矛盾がある場合は **この STYLE.md を優先**し、必要に応じて言語別ドキュメント側を更新してください。

---

## 1. Change discipline（変更の規律）

### 1.1 最小差分・単一目的
- 1 PR = 1目的（issue/チケットがなければ PR 本文に背景を書く）。
- 目的外のリファクタ、整形、命名変更は禁止（やるなら別PR）。
- “ついでの改善”は禁止（レビュー負荷と事故率が上がる）。

### 1.2 分割の目安
- 大きい変更は分割する（目安：200〜400 LOC、5〜10 files）。
- 仕様/設計と実装が絡む場合は、設計メモ（ADR等）→実装PRの順を推奨。

---

## 2. Readability（説明可能性）

### 2.1 説明できるコードを優先
- 変更の意図がコードから読み取れない場合、先に設計/説明を追加する。
- “賢い抽象化”より “理解できる実装” を優先する。
- 過剰な汎用化（将来のためのジェネリクス化、使われない拡張点）は避ける。

### 2.2 コメントは Why
- コメントは「なぜそうしたか（Why）」を書く（What はコードで表現）。
- 制約・前提・互換性・理由がある分岐には短い Why コメントを付ける。

---

## 3. Error handling（エラー）

### 3.1 エラーは握りつぶさない
- 失敗しうる処理は呼び出し側が判断できる形で返す/伝える。
- silent failure（黙って成功扱い）は禁止。

### 3.2 文脈の付与
- エラーに文脈を足す場合、「何が失敗したか」が分かる文言にする。
- 外向け/内部向けの詳細を混ぜない（必要なら分離）。

---

## 4. Logging（ログ）/ Security（秘匿）

### 4.1 ログは最小限で診断可能に
- ログは障害解析に必要な最小限にする。
- ループ内の大量ログは禁止（必要ならレベルや頻度を調整）。

### 4.2 秘密情報・個人情報を出さない
- token/password/secret/PII をログ・エラー・テストデータに含めない。
- 監査上問題になり得る情報は出力しない（必要ならマスク）。

---

## 5. Naming（命名）

- 略語は最小限（チームで共有される略語のみ）。
- 名称は責務を表す（process/do/handle の連発は避ける）。
- boolean は `is_` / `has_` / `should_` のように意図が分かる形にする。

---

## 6. Tests（テスト）

### 6.1 変更にはテストを含める
- バグ修正は回帰テストを原則必須。
- 仕様変更は対応するテスト更新/追加を含める。

### 6.2 テストも読みやすく
- Arrange / Act / Assert を意識する。
- 準備が長い場合はヘルパー化する（ただし抽象化しすぎない）。
- ランダム性が必要なら seed 固定で再現性を確保する。

---

## 7. Compatibility（互換性）

- 公開API/設定/データ互換性の破壊は原則禁止。
- 互換性に影響する変更は、影響範囲・移行手順・後方互換の扱いを PR に明記する。
- 破壊的変更が避けられない場合は、実装前に設計メモ（ADR等）を残す。

---

## 8. Dependencies（依存）

- 新規依存追加・大きな更新は慎重に行う。
- 追加/更新時は理由・代替案・影響（サイズ/ライセンス/セキュリティ）を PR に書く。

---

## 9. Documentation（ドキュメント）

- Public API / 重要な挙動変更は README / docs を更新する。
- 同じ話題の文書が複数ある場合は「どれが正本か」を明示する（重複を作らない）。

---

## 10. Minimum review checklist（最低チェック）
PRは最低限以下を満たすこと：
- 目的が明確（What/Why/How/Testing が説明できる）
- 目的外の差分がない
- エラー/ログが方針に沿っている（秘匿漏れがない）
- 境界条件が考慮されている
- テストがある（または不要の理由が明記されている）
- 互換性・移行が必要なら明記されている
