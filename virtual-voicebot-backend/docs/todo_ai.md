# docs/todo_ai.md

## 挙動を変えないリファクタ
- [x] ai モジュールの asr/llm/tts サブモジュール境界を定義し、既存の一体化関数を薄いラッパに切り出す（挙動は同じ）。
- [x] app/ai 間のイベント/チャネル案を docs に追記し、現行コードとの差分をコメントで明示する（コードはまだ触らない）。
- [x] session 内の AI 呼び出し箇所に「app/aiへ移行予定」のコメントを付け、呼び出し部を関数に分離して差し替えやすくする（挙動は維持）。
- [x] 既存のファイル入出力（WAV 一時ファイル）や HTTP エンドポイント使用箇所に責務境界をコメントで示す。

## 挙動を変えるリファクタ（責務移譲・配線変更）
- [ ] ai::{asr,llm,tts} を独立 I/F（PCM入力/テキスト入出力）に分割し、ストリーミング/チャンク単位の処理に対応させる。
- [x] app→ai 呼び出し経路を実装し、session からの AI 直呼びを廃止する。
- [ ] ai 側で ASR/LLM/TTS のエラーポリシー（リトライ/フォールバック/デフォルト応答）を統一し、app に結果を返す。
- [ ] PCM/WAV を介した暫定実装をやめ、チャネル経由で音声/テキストを渡すフローに切り替える。
- [x] 新チャネル経路で音声→ASR→LLM→TTS→session の往復スモークを通し、旧ハードコード経路を削除する。
