# STEER-213: AI エージェントのドキュメント責務不整合の修正

---

## 1. メタ情報

| 項目 | 値 |
|------|-----|
| ID | STEER-213 |
| タイトル | AI エージェントのドキュメント責務不整合の修正 |
| ステータス | Approved |
| 関連Issue | #213 |
| 優先度 | P0 |
| 作成日 | 2026-02-22 |

---

## 2. ストーリー（Why）

### 2.1 背景

STEER-153（#153）で導入した「Review 以降のステアリング修正は Codex が担当」というルールが、
実運用でデッドロックを引き起こした。

**問題シナリオ:**
1. Review ステータスのステアリングにレビュー指摘が入る
2. Claude Code：「Review 以降の編集は禁止（CLAUDE.md §禁止事項）」→ 何もしない
3. Codex：「ステアリング修正には Claude Code のレビューが必要（AGENTS.md §例外1-5）」→ Claude Code が動かないため進まない
4. 両者とも動かず作業停止

### 2.2 根本原因

STEER-153 の変更が「Claude Code の使用量節約」を目的とした結果、
責務分担に次の矛盾が生まれた。

| 文書 | 記述 | 結果 |
|------|------|------|
| CLAUDE.md §禁止事項 | Review 以降のステアリング編集は禁止 | Claude Code が止まる |
| AGENTS.md §例外1-5 | Codex の修正には Claude Code のレビューが必要 | Codex も止まる |

### 2.3 目的

責務を「Claude Code = ドキュメント全般担当、Codex = コード担当」という単純明快な原則に戻す。

---

## 3. 段取り（Who / When）

### 3.1 起票

| 項目 | 値 |
|------|-----|
| 起票者 | @MasanoriSuda |
| 起票日 | 2026-02-22 |
| 起票理由 | AGENTS.md と CLAUDE.md の不整合による作業デッドロックの解消 |

### 3.2 仕様作成

| 項目 | 値 |
|------|-----|
| 作成者 | Claude Sonnet 4.6 |
| 作成日 | 2026-02-22 |
| 指示者 | @MasanoriSuda |
| 指示内容 | "AGENTS.md は原則ドキュメントを直さない（例外はオーナー指示）、CLAUDE.md は常時ドキュメントを直すように再修正" |

### 3.3 レビュー

| # | レビュアー | 日付 | 結果 | コメント |
|---|-----------|------|------|---------|
| 1 |@MasanoriSuda | 2026-02-22 | OK |lgtm|

### 3.4 承認

| 項目 | 値 |
|------|-----|
| 承認者 | @MasanoriSuda |
| 承認日 | 2026-02-22 |
| 承認コメント | lgtm |

### 3.5 実装

（未着手）

### 3.6 マージ

| 項目 | 値 |
|------|-----|
| マージ実行者 | @MasanoriSuda |
| マージ日 | 2026-02-22 |
| マージ先 | CLAUDE.md, AGENTS.md（root）, virtual-voicebot-backend/AGENTS.md（仕様名形式の正本への反映は不要。規約ドキュメントの直接更新として完結） |

---

## 4. スコープ

### 4.1 対象（含む）

- `CLAUDE.md`：禁止事項の変更・ステアリング担当範囲の拡大・責務テーブル更新
- `AGENTS.md`（root）：§ドキュメント更新の扱い 例外1 削除・例外番号振り直し・レビュー運用更新
- `virtual-voicebot-backend/AGENTS.md`：§1.3.1 テーブル更新・§8.1.1 削除

### 4.2 対象外（除く）

- プロダクションコードの変更
- Frontend 固有ドキュメント（影響なし）
- 本体仕様書（RD/BD/DD）の内容変更

---

## 5. 差分仕様（What / How）

### 5.1 CLAUDE.md の変更

#### 5.1.1 ステアリング担当範囲の拡大（§役割）

```diff
-  - **ステアリング（差分仕様）：Draft 作成のみ**
-    - 新規ステアリングの作成（Status: Draft）
+  - **ステアリング（差分仕様）：全フェーズ担当**
+    - 新規ステアリングの作成（Status: Draft）
+    - Review 時のレビュー指摘対応・修正（Status: Review）
```

#### 5.1.2 禁止事項の変更

```diff
 ### Claude Code の禁止事項

-- **Review 以降のステアリング編集は行わない**（事実誤記の修正は例外）
-  - Status: Review/Approved のステアリングは Codex が修正する（レビュー必須）
-  - Claude Code は Draft 作成後、レビュー依頼を受けた場合のみ関与
-  - **例外 — 事実誤記修正**: 以下の条件を全て満たす場合は Claude Code が直接修正可
-    1. ストーリー（Why）・決定事項の意図を変えない
-    2. コード参照の行番号誤り・実装挙動の不正確な表現など事実確認で決まる修正のみ
-    3. `AskUserQuestion` でオーナーの明示的な許可を得ること
+- **プロダクションコードの実装・修正は行わない**
+- **Status を勝手に変更しない**（Status 更新は人間が判断）
+- **ストーリー（§2）変更は必ず Issue で合意を得てから行う**
```

#### 5.1.3 責務テーブルの変更（§責務の境界）

```diff
-| ステアリング（Review時修正） | ❌ 禁止（事実誤記はオーナー許可で例外） | ✓ 可 | Status: Review/Approved + レビュー必須 |
+| ステアリング（Review時修正） | ✓ 担当 | ❌ 禁止 | - |
```

### 5.2 AGENTS.md（root）の変更

#### 5.2.1 §ドキュメント更新の扱い：例外1 の削除

以下のセクションを丸ごと削除する。

```text
### 例外1: ステアリングファイル（Review以降の修正のみ）
...（条件1〜6 および禁止事項リスト全体）
```

削除後、「例外2: オーナー許可（DOCS_OK）」を「例外1」に、
「例外3: 軽微修正」を「例外2」に番号を振り直す。

#### 5.2.2 §ドキュメント更新の扱い：ステアリングの扱いを明示

原則セクションの直後に以下を追加する。

```markdown
### ステアリングファイルの扱い（必須）

- **新規作成・Review 対応**: Claude Code が担当。Codex は一切編集しない。
- **Approved 以降の段取り更新**（§3.5 のみ）: Codex が実装完了記録として更新可能。
- **禁止事項**:
  - Codex による新規ステアリングの作成
  - Codex による §5 差分仕様・§6 受入条件・§2 ストーリーの変更
  - Status の勝手な変更（Status 更新は人間が判断）
  - `docs/STEER-*.md`（root 直下）への配置（正規3箇所のみ使用）
```

#### 5.2.3 §レビュー運用：ステアリング Review 時の手順変更

```diff
-1. **Codex が修正**: ステアリング §5 等をレビュー指摘に基づき修正
+1. **Claude Code が修正**: ステアリング §5 等をレビュー指摘に基づき修正
```

### 5.3 virtual-voicebot-backend/AGENTS.md の変更

#### 5.3.1 §1.3.1 ステアリングファイルの修正権限テーブル

```diff
-| Review | ❌ 禁止 | ✓ 修正可 | レビュー指摘への対応（レビュー必須） |
+| Review | ✓ 担当 | ❌ 禁止 | レビュー指摘への対応は Claude Code が実施 |
```

#### 5.3.2 §8.1.1 Review 時の対応セクションの削除

Codex が Review ステアリングを修正する手順（§8.1.1 全体）を削除する。

§8.1.2 は §8.1.1 に番号繰り上げ、タイトルを「実装時の対応（Approved以降）」に変更。

---

## 6. 受入条件（Acceptance Criteria）

- [ ] AC-1: CLAUDE.md に「Review 時のレビュー指摘対応・修正」が Claude Code 担当として記載されていること
- [ ] AC-2: CLAUDE.md の禁止事項から「Review 以降のステアリング編集は行わない」が削除されていること
- [ ] AC-3: CLAUDE.md の責務テーブルで「ステアリング（Review時修正）」が Claude Code ✓ 担当, Codex ❌ 禁止になっていること
- [ ] AC-4: AGENTS.md（root）から「例外1: ステアリングファイル」セクションが削除されていること
- [ ] AC-5: AGENTS.md（root）に「ステアリングファイルの扱い」セクションが追加されていること
- [ ] AC-6: AGENTS.md（root）の例外番号が振り直されていること（DOCS_OK が例外1、軽微修正が例外2）
- [ ] AC-7: AGENTS.md（root）の §レビュー運用 が「Claude Code が修正」になっていること
- [ ] AC-8: virtual-voicebot-backend/AGENTS.md の §1.3.1 テーブルで Review 行が更新されていること
- [ ] AC-9: virtual-voicebot-backend/AGENTS.md の §8.1.1 が削除または Claude Code 担当に更新されていること

---

## 7. 未確定点・質問

- なし（オーナーの指示明確）

---

## 8. リスク/ロールバック観点

| リスク | 影響 | 緩和策 |
|--------|------|--------|
| Claude Code の使用量が再び増加 | 元の問題（STEER-153 動機）が再発 | 使用量が問題になった場合は再度 Issue を立てて対処 |
| Codex が旧ルール（例外1）を参照してステアリングを修正 | 責務侵食 | AGENTS.md の禁止事項に明示 |

**ロールバック手順:**
- 本ステアリング実装コミットを `git revert` で取り消し
- STEER-153 の内容に戻る
