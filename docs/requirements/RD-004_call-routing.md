# RD-004: 電話番号振り分け・迷惑電話対策

> 電話番号に基づく着信振り分けと迷惑電話対策機能の要件定義

| 項目 | 値 |
|------|-----|
| ID | RD-004 |
| ステータス | Draft |
| 作成日 | 2026-01-31 |
| 関連Issue | TBD |
| 対応ST | ST-003（予定） |

---

## 1. 背景・目的

### 1.1 背景

ひかり電話回線に対して、以下の課題が発生している：

| 課題 | 詳細 |
|------|------|
| **迷惑電話の頻発** | SES（システムエンジニアリングサービス）、人材派遣会社からの技術者提案、不動産営業などの営業電話が頻繁にかかってくる |
| **対応コスト** | 本来無視したいが、しつこくかけてくるため業務が中断される |
| **IVR突破** | コールセンター用のIVRを導入済みだが、それでもかけてくる業者がいる |
| **言った言わない問題** | 通話内容の証拠が残らず、トラブル時に対応困難 |
| **重要顧客の見逃し** | 迷惑電話対策を強化すると、重要顧客からの着信も見逃すリスク |

### 1.2 目的

- **迷惑電話対策**: 発信者番号に基づいて迷惑電話を自動ブロック/居留守対応
- **業務効率化**: コールセンター業務のIVR振り分けを自動化
- **重要顧客対応**: VIP顧客からの着信は即座に通知・転送
- **証拠保全**: 全通話を録音し、後から確認可能にする
- **一元管理**: ブラウザから発着信履歴・録音・設定を管理

---

## 2. スコープ

### 2.1 対象範囲

- 電話番号に基づく着信振り分けルールエンジン
- 迷惑電話対策（居留守、お断りアナウンス）
- IVR機能（DTMF入力による振り分け）
- 通話録音・録音通知アナウンス
- ブラウザ管理画面（履歴・録音・設定）

### 2.2 対象外（将来検討）

- 音声認識によるIVR振り分け（将来フェーズ）
- AIによる迷惑電話自動判定
- 発信機能（UAC）
- 複数回線対応

---

## 3. ターゲットユーザー

| ユーザー | 説明 | 主な操作 |
|---------|------|---------|
| **システム管理者** | 振り分けルール・電話番号設定を管理 | 設定画面での番号登録・ルール設定 |
| **オペレーター** | コールセンター業務担当 | IVR経由での着信対応、履歴確認 |
| **一般社員** | 重要顧客からの着信を受ける | 着信通知の確認 |
| **発信者（顧客）** | 電話をかけてくる相手 | IVRメニュー操作、オペレーター接続 |

---

## 4. 機能要件

### 4.1 電話番号振り分けエンジン

| ID | 要件 | 優先度 | 説明 |
|----|------|:------:|------|
| FR-100 | 発信者番号による振り分けルール定義 | P0 | 電話番号ごとにアクション（着信/拒否/IVR等）を設定 |
| FR-101 | 番号パターンマッチング | P0 | 前方一致（03-xxxx）、完全一致、正規表現対応 |
| FR-102 | デフォルトルール | P0 | マッチしない番号へのデフォルト動作設定 |
| FR-103 | 番号カテゴリ分類 | P1 | 迷惑電話/VIP/一般/コールセンター等のカテゴリ |
| FR-104 | 番号リストインポート/エクスポート | P2 | CSV形式での一括登録・出力 |

### 4.2 着信アクション

| ID | 要件 | 優先度 | 説明 |
|----|------|:------:|------|
| FR-110 | 通常着信（転送） | P0 | 内線または外線へ着信転送 |
| FR-111 | 着信拒否（無応答） | P0 | 居留守対応。一定コール後に切断 |
| FR-112 | お断りアナウンス | P0 | 「おかけになった電話番号は〜」等のアナウンス後切断 |
| FR-113 | IVR誘導 | P0 | 自動音声ガイダンスでメニュー選択へ誘導 |
| FR-114 | 録音のみ | P1 | 留守番電話として録音のみ受付 |
| FR-115 | 時間帯別ルール | P2 | 営業時間内/外で異なるアクション |

### 4.3 IVR機能

| ID | 要件 | 優先度 | 説明 |
|----|------|:------:|------|
| FR-120 | ウェルカムメッセージ再生 | P0 | 着信時に自動音声ガイダンス再生 |
| FR-121 | DTMFメニュー | P0 | **0-9（10選択肢）** の分岐対応（Q5回答） |
| FR-122 | 多階層メニュー | P1 | サブメニューへの遷移、**最大3階層**（Q5回答） |
| FR-123 | タイムアウト処理 | P0 | 入力待ちタイムアウト時の再生・切断 |
| FR-124 | 無効入力処理 | P0 | 無効なDTMF入力時の再案内 |
| FR-125 | オペレーター転送 | P0 | DTMF選択によるオペレーター接続 |
| FR-126 | 音声認識振り分け | P2 | 「はい」「いいえ」等の音声入力対応（将来） |

### 4.4 録音機能

| ID | 要件 | 優先度 | 説明 |
|----|------|:------:|------|
| FR-130 | 通話録音 | P0 | 全通話または設定通話を録音 |
| FR-131 | 録音通知アナウンス | P0 | 「この通話は録音されます」アナウンス |
| FR-132 | 録音有無設定（番号別） | P0 | 電話番号ごとに録音ON/OFF設定 |
| FR-133 | 録音通知有無設定（番号別） | P0 | 録音通知アナウンスのON/OFF設定 |
| FR-134 | 録音ファイル保存期間 | P1 | 自動削除までの保存日数設定 |

### 4.5 管理画面（ブラウザ）

| ID | 要件 | 優先度 | 説明 |
|----|------|:------:|------|
| FR-140 | 発着信履歴一覧 | P0 | 日時、発信者番号、着信先、通話時間、アクション |
| FR-141 | 履歴検索・フィルタ | P0 | 番号、期間、カテゴリでの絞り込み |
| FR-142 | 録音ファイル再生 | P0 | ブラウザ上での録音再生（シーク対応） |
| FR-143 | 録音ファイルダウンロード | P1 | 個別・一括ダウンロード |
| FR-144 | 電話番号設定画面 | P0 | 番号登録、カテゴリ設定、アクション設定 |
| FR-145 | IVRシナリオ設定 | P1 | メニュー構成、音声ファイル設定 |
| FR-146 | 統計ダッシュボード | P2 | 着信数、拒否数、カテゴリ別集計 |
| FR-147 | ユーザー認証・権限管理 | P0 | ログイン、ロールベースアクセス制御 |

---

## 5. 非機能要件

### 5.1 性能

| ID | 要件 | 目標値 | 備考 |
|----|------|--------|------|
| NFR-100 | 振り分け判定時間 | 100ms以内 | |
| NFR-101 | 同時通話数 | **2通話** | Q2回答に基づく |
| NFR-102 | 番号登録上限 | 1,000件 | 個人利用規模に調整 |
| NFR-103 | 履歴保存期間 | TBD | Q3で決定予定 |

### 5.2 可用性

| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-110 | サービス稼働率 | 99.9% |
| NFR-111 | 障害検知 | 1分以内 |
| NFR-112 | 障害復旧 | 10分以内 |

### 5.3 セキュリティ

| ID | 要件 | 説明 | 備考 |
|----|------|------|------|
| NFR-120 | 録音データ保護 | 暗号化保存、アクセス制御 | |
| NFR-121 | 管理画面認証 | HTTPS、セッション管理 | **シングルユーザー（管理者のみ）**（Q4回答） |
| NFR-122 | 監査ログ | 設定変更・録音アクセスのログ記録 | |
| NFR-123 | 個人情報保護 | 録音データはPIIとして適切に管理 | |

### 5.4 運用性

| ID | 要件 | 説明 |
|----|------|------|
| NFR-130 | ログ出力 | 構造化ログ、相関ID付与 |
| NFR-131 | 設定変更即時反映 | 番号設定変更後、即座に適用 |
| NFR-132 | バックアップ | 設定・履歴の定期バックアップ |

---

## 6. ユーザーストーリー

### 6.1 迷惑電話対策

```
US-100: 迷惑電話を自動ブロック
  As a システム管理者
  I want to 迷惑電話番号を登録して居留守対応する
  So that 業務が中断されない

  受入条件:
  - 番号を「迷惑電話」カテゴリで登録できる
  - 登録番号からの着信は無応答（居留守）になる
  - 一定コール後に自動切断される
```

```
US-101: しつこい営業電話にお断りアナウンス
  As a システム管理者
  I want to 繰り返しかけてくる番号にお断りメッセージを流す
  So that 相手に着信拒否を明示できる

  受入条件:
  - 番号に「お断りアナウンス」アクションを設定できる
  - 着信時に設定したアナウンスが再生される
  - アナウンス後に自動切断される
```

### 6.2 重要顧客対応

```
US-110: VIP顧客からの着信を優先
  As a 一般社員
  I want to 重要顧客からの電話は即座に着信する
  So that 大切な顧客を待たせない

  受入条件:
  - 番号を「VIP」カテゴリで登録できる
  - VIP番号からの着信は通常着信（転送）される
  - 着信時にVIP表示される（将来）
```

### 6.3 コールセンター業務

```
US-120: IVRで問い合わせ振り分け
  As a 発信者（顧客）
  I want to 自動音声ガイダンスで適切な担当に繋がる
  So that 用件に応じた対応を受けられる

  受入条件:
  - 着信時にウェルカムメッセージが流れる
  - DTMFでメニュー選択できる
  - 選択に応じてオペレーターに転送される
```

### 6.4 録音・履歴管理

```
US-130: 通話を録音して証拠保全
  As a システム管理者
  I want to 全通話を録音する
  So that 言った言わないのトラブルに対応できる

  受入条件:
  - 通話開始時に「録音されます」アナウンスが流れる
  - 通話終了後に録音ファイルが保存される
  - ブラウザから録音を再生・ダウンロードできる
```

```
US-131: 発着信履歴を確認
  As a オペレーター
  I want to 過去の発着信履歴を検索する
  So that 対応状況を確認できる

  受入条件:
  - 日時、番号、カテゴリで検索できる
  - 録音がある場合は再生ボタンが表示される
  - 履歴から番号設定画面へ遷移できる
```

---

## 7. ユースケース

### 7.1 アクター定義

本システムは **Frontend（AWS）** と **Backend（オンプレミス）** の分離構成のため、アクターを以下のように分類する。

| カテゴリ | アクター | 説明 | 主に操作するシステム |
|---------|---------|------|---------------------|
| **Frontend利用者** | 管理者 | 番号設定・IVR設定・システム設定を行う | Frontend（管理画面） |
| | 履歴閲覧者 | 発着信履歴・録音を確認する | Frontend（管理画面） |
| **Backend利用者** | 発信者（顧客） | 電話をかけ、IVR操作・通話を行う | Backend（電話回線経由） |
| **開発者** | Backend開発者 | Backend環境構築・API開発・デバッグ | Backend（Raspberry Pi/PC） |
| **運用者** | システム運用者 | 監視・障害対応・データ管理 | 両方 |

### 7.2 ユースケース図（システム分離版）

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              電話番号振り分けシステム                              │
├────────────────────────────────────┬────────────────────────────────────────────┤
│        Frontend（AWS）             │         Backend（オンプレミス）              │
│                                    │                                            │
│  ┌────────┐                        │                        ┌────────┐         │
│  │ 管理者 │                        │                        │ 発信者 │         │
│  └───┬────┘                        │                        │（顧客）│         │
│      │                             │                        └───┬────┘         │
│      │ ┌─────────────────────┐     │     ┌─────────────────────┐ │             │
│      ├─┤ UC-F01: 番号設定    │─────┼────►│ UC-B01: 着信処理    │◄┤             │
│      │ └─────────────────────┘     │     └─────────────────────┘ │             │
│      │ ┌─────────────────────┐     │     ┌─────────────────────┐ │             │
│      ├─┤ UC-F02: IVR設定     │─────┼────►│ UC-B02: IVR実行     │◄┤             │
│      │ └─────────────────────┘     │     └─────────────────────┘ │             │
│      │ ┌─────────────────────┐     │     ┌─────────────────────┐ │             │
│      ├─┤ UC-F03: ルール設定  │─────┼────►│ UC-B03: 通話録音    │◄┤             │
│      │ └─────────────────────┘     │     └─────────────────────┘ │             │
│      │                             │                              │             │
│  ┌─────────┐                       │                              │             │
│  │履歴閲覧者│                       │                              │             │
│  └────┬────┘                       │                              │             │
│       │ ┌─────────────────────┐    │     ┌─────────────────────┐  │             │
│       ├─┤ UC-F04: 履歴確認   │◄───┼─────┤ UC-B04: 履歴同期    │──┘             │
│       │ └─────────────────────┘    │     └─────────────────────┘               │
│       │ ┌─────────────────────┐    │     ┌─────────────────────┐               │
│       └─┤ UC-F05: 録音再生   │◄───┼─────┤ UC-B05: 録音保存    │               │
│         └─────────────────────┘    │     └─────────────────────┘               │
│                                    │                                            │
├────────────────────────────────────┴────────────────────────────────────────────┤
│                            開発者・運用者 ユースケース                            │
│                                                                                 │
│  ┌─────────────┐  ┌─────────────────────┐  ┌─────────────────────┐             │
│  │Backend開発者│──┤ UC-D01: 環境構築   │  │ UC-D02: API開発    │             │
│  └─────────────┘  └─────────────────────┘  └─────────────────────┘             │
│                                                                                 │
│  ┌─────────────┐  ┌─────────────────────┐  ┌─────────────────────┐             │
│  │システム運用者│──┤ UC-O01: 監視       │  │ UC-O02: 障害対応   │             │
│  └─────────────┘  └─────────────────────┘  └─────────────────────┘             │
│                   ┌─────────────────────┐  ┌─────────────────────┐             │
│                   │ UC-O03: バックアップ│  │ UC-O04: 同期確認   │             │
│                   └─────────────────────┘  └─────────────────────┘             │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

### 7.3 ユースケース詳細

---

## 7.3.1 Frontend利用者ユースケース

> Frontend（AWS上のNext.js管理画面）を操作するユーザーのユースケース

#### UC-F01: 電話番号を登録・編集する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F01 |
| **アクター** | 管理者 |
| **システム** | Frontend（AWS） |
| **概要** | 電話番号とその設定を管理画面から登録・編集し、Backendに同期 |
| **事前条件** | 管理画面にログイン済み |
| **事後条件** | Frontend DBに保存、Backend APIへPush |

**基本フロー**:

| # | アクター | Frontend | Backend |
|---|---------|----------|---------|
| 1 | 番号設定画面を開く | | |
| 2 | | 登録済み番号一覧を表示 | |
| 3 | 番号・カテゴリ・アクション等を入力 | | |
| 4 | 「保存」をクリック | | |
| 5 | | バリデーション実行 | |
| 6 | | Frontend DBに保存 | |
| 7 | | Backend APIを呼び出し | 設定を受信・ローカルDBに保存 |
| 8 | | 同期成功を確認 | |
| 9 | | 「保存しました」表示 | |

**入力項目**:

| 項目 | 必須 | 説明 |
|------|:----:|------|
| 電話番号 | ○ | 完全一致 or パターン |
| カテゴリ | ○ | 迷惑電話/VIP/一般 |
| アクション | ○ | 通常着信/居留守/お断り/IVR/留守電 |
| 録音有無 | ○ | ON/OFF |
| メモ | - | 管理用メモ（会社名等） |

**代替フロー**:

| 条件 | 処理 |
|------|------|
| Backend API接続失敗 | 「Backendと通信できません」エラー、リトライ案内 |
| 番号が既に登録済み | 「この番号は既に登録されています」エラー |

---

#### UC-F02: IVRシナリオを設定する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F02 |
| **アクター** | 管理者 |
| **システム** | Frontend（AWS） |
| **概要** | IVRの音声ガイダンスとメニュー構成を設定し、Backendに同期 |
| **事前条件** | 管理画面にログイン済み |
| **事後条件** | IVRシナリオがFrontend DBに保存、Backend APIへPush |

**基本フロー**:

| # | アクター | Frontend | Backend |
|---|---------|----------|---------|
| 1 | IVR設定画面を開く | | |
| 2 | | シナリオ一覧を表示 | |
| 3 | シナリオを選択/新規作成 | | |
| 4 | メニュー構成を設定（DTMF 0-9、最大3階層） | | |
| 5 | 音声ファイルをアップロード | S3にアップロード | |
| 6 | 「保存」をクリック | | |
| 7 | | Frontend DBに保存 | |
| 8 | | Backend APIを呼び出し | シナリオを受信・ローカルDBに保存 |

**シナリオ設定項目**:

| 項目 | 説明 |
|------|------|
| シナリオ名 | 識別用の名前 |
| ウェルカムメッセージ | 音声ファイル or TTS文言 |
| メニュー項目 | DTMF（0-9）ごとの動作、最大3階層 |
| タイムアウト秒数 | 入力待ち時間 |

---

#### UC-F03: 振り分けルールを設定する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F03 |
| **アクター** | 管理者 |
| **システム** | Frontend（AWS） |
| **概要** | 番号パターンや時間帯による振り分けルールを設定 |
| **事前条件** | 管理画面にログイン済み |
| **事後条件** | ルールがFrontend DBに保存、Backend APIへPush |

**ルール設定項目**:

| 項目 | 説明 |
|------|------|
| 優先順位 | 上から順に評価（1が最優先） |
| 条件：番号パターン | 前方一致、完全一致 |
| 条件：時間帯 | 営業時間内/外 |
| 条件：カテゴリ | 迷惑電話/VIP等 |
| アクション | 着信/居留守/お断り/IVR/留守電 |

---

#### UC-F04: 発着信履歴を確認する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F04 |
| **アクター** | 管理者、履歴閲覧者 |
| **システム** | Frontend（AWS） |
| **概要** | Backendから同期された発着信履歴を検索・閲覧 |
| **事前条件** | 管理画面にログイン済み |
| **事後条件** | なし（参照のみ） |

**基本フロー**:

| # | アクター | Frontend |
|---|---------|----------|
| 1 | 履歴画面を開く | |
| 2 | | Frontend DBから履歴を取得し表示 |
| 3 | 検索条件を入力（期間、番号、カテゴリ等） | |
| 4 | | 条件に合致する履歴を表示 |
| 5 | 履歴行をクリック | |
| 6 | | 詳細情報を表示（録音再生ボタン含む） |

**検索条件**:

| 項目 | 説明 |
|------|------|
| 期間 | 開始日時〜終了日時 |
| 電話番号 | 部分一致検索 |
| カテゴリ | 迷惑電話/VIP/一般等 |
| アクション結果 | 着信/居留守/お断り/IVR等 |

---

#### UC-F05: 録音を再生・ダウンロードする

| 項目 | 内容 |
|------|------|
| **ID** | UC-F05 |
| **アクター** | 管理者、履歴閲覧者 |
| **システム** | Frontend（AWS）、S3 |
| **概要** | S3に保存された録音ファイルをブラウザで再生またはダウンロード |
| **事前条件** | 録音が存在する履歴を選択済み |
| **事後条件** | なし |

**基本フロー（再生）**:

| # | アクター | Frontend | S3 |
|---|---------|----------|-----|
| 1 | 再生ボタンをクリック | | |
| 2 | | S3の署名付きURLを生成 | |
| 3 | | 音声プレイヤーを表示 | ファイルをストリーミング配信 |
| 4 | シークバーで位置調整 | | Range対応で部分配信 |

---

#### UC-F06: ダッシュボードで状況を把握する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F06 |
| **アクター** | 管理者、履歴閲覧者 |
| **システム** | Frontend（AWS） |
| **概要** | システムの稼働状況と直近の着信状況を一目で確認 |
| **事前条件** | 管理画面にログイン済み |
| **事後条件** | なし（参照のみ） |

**ダッシュボード表示項目**:

| セクション | 表示内容 |
|-----------|---------|
| システム状態 | Backend接続状態、最終同期時刻 |
| 今日のサマリー | 総着信数、ブロック数、VIP着信数 |
| 直近の着信 | 最新5〜10件の着信一覧 |
| 未確認アラート | 留守電メッセージ、VIP着信通知 |

**基本フロー**:

| # | アクター | Frontend |
|---|---------|----------|
| 1 | ログイン / ダッシュボードを開く | |
| 2 | | Backend APIでステータス取得 |
| 3 | | Frontend DBから統計・履歴取得 |
| 4 | | ダッシュボードを描画 |
| 5 | 各項目をクリック | 詳細画面へ遷移 |

---

#### UC-F07: 通知を設定・受信する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F07 |
| **アクター** | 管理者 |
| **システム** | Frontend（AWS） |
| **概要** | 重要イベント発生時の通知設定と受信 |
| **事前条件** | 管理画面にログイン済み |
| **事後条件** | 通知設定がDBに保存 |

**通知イベント**:

| イベント | 説明 | デフォルト |
|---------|------|-----------|
| VIP着信 | VIPカテゴリの番号から着信があった | ON |
| 留守電受信 | 留守番電話にメッセージが残された | ON |
| Backend切断 | Backendとの通信が途絶えた | ON |
| 同期エラー | Frontend↔Backend間の同期に失敗 | ON |
| 大量着信 | 同一番号から短時間に複数回着信 | OFF |

**通知方法**:

| 方法 | 説明 |
|------|------|
| ブラウザ通知 | PWA Push通知 |
| メール通知 | 登録メールアドレスへ送信 |
| LINE通知 | LINE Notify連携（将来） |

---

#### UC-F08: 番号リストを一括インポート/エクスポートする

| 項目 | 内容 |
|------|------|
| **ID** | UC-F08 |
| **アクター** | 管理者 |
| **システム** | Frontend（AWS） |
| **概要** | 電話番号設定をCSV形式で一括登録・出力 |
| **事前条件** | 管理画面にログイン済み |
| **事後条件** | インポート時: DBに保存、Backendに同期 |

**基本フロー（インポート）**:

| # | アクター | Frontend | Backend |
|---|---------|----------|---------|
| 1 | 「インポート」をクリック | | |
| 2 | CSVファイルを選択 | | |
| 3 | | CSVをパース、バリデーション | |
| 4 | | プレビュー表示（追加/更新/エラー件数） | |
| 5 | 「実行」をクリック | | |
| 6 | | Frontend DBに保存 | |
| 7 | | Backend APIを呼び出し | 一括同期 |
| 8 | | 結果レポート表示 | |

**CSVフォーマット**:

```csv
phone_number,category,action,recording,memo
03-1234-5678,nuisance,ignore,,営業電話
090-xxxx-xxxx,vip,transfer,on,重要顧客A社
```

**基本フロー（エクスポート）**:

| # | アクター | Frontend |
|---|---------|----------|
| 1 | 「エクスポート」をクリック | |
| 2 | | 全番号設定をCSV形式で生成 |
| 3 | | ファイルダウンロード |

---

#### UC-F09: 統計・レポートを確認する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F09 |
| **アクター** | 管理者、履歴閲覧者 |
| **システム** | Frontend（AWS） |
| **概要** | 着信傾向や迷惑電話ブロック効果を可視化 |
| **事前条件** | 管理画面にログイン済み |
| **事後条件** | なし（参照のみ） |

**レポート項目**:

| レポート | 内容 |
|---------|------|
| 期間別着信数 | 日別/週別/月別の着信数推移 |
| カテゴリ別内訳 | 迷惑電話/VIP/一般の割合 |
| アクション別内訳 | 着信/居留守/お断り/IVRの割合 |
| ブロック効果 | 迷惑電話ブロック件数と推移 |
| 時間帯別傾向 | 時間帯ごとの着信パターン |
| 発信者ランキング | 着信頻度の高い番号TOP10 |

**基本フロー**:

| # | アクター | Frontend |
|---|---------|----------|
| 1 | 統計画面を開く | |
| 2 | 期間を選択（今日/今週/今月/カスタム） | |
| 3 | | Frontend DBから集計 |
| 4 | | グラフ・表を描画 |
| 5 | 「エクスポート」をクリック | PDF/CSVでダウンロード |

---

#### UC-F10: 履歴からクイックアクションを実行する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F10 |
| **アクター** | 管理者、履歴閲覧者 |
| **システム** | Frontend（AWS） |
| **概要** | 発着信履歴から直接、番号の登録・変更を行う |
| **事前条件** | 履歴画面を表示中 |
| **事後条件** | 番号設定がDBに保存、Backendに同期 |

**クイックアクション**:

| アクション | 説明 | 対象 |
|-----------|------|------|
| ブロック | この番号を迷惑電話として登録 | 未登録番号 |
| VIPに追加 | この番号をVIPとして登録 | 未登録番号 |
| カテゴリ変更 | 登録済み番号のカテゴリを変更 | 登録済み番号 |
| 誤ブロック解除 | 誤ってブロックした番号を解除 | 迷惑電話登録番号 |
| 番号設定へ | 詳細な設定画面へ遷移 | 全番号 |

**基本フロー（ブロック）**:

| # | アクター | Frontend | Backend |
|---|---------|----------|---------|
| 1 | 履歴行の「ブロック」をクリック | | |
| 2 | | 確認ダイアログ表示 | |
| 3 | 「ブロックする」をクリック | | |
| 4 | | 迷惑電話カテゴリで番号登録 | |
| 5 | | Backend APIを呼び出し | 同期 |
| 6 | | 「ブロックしました」表示 | |

---

#### UC-F11: データ保存期間を管理する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F11 |
| **アクター** | 管理者 |
| **システム** | Frontend（AWS）、S3 |
| **概要** | 履歴・録音データの保存期間設定と手動削除 |
| **事前条件** | 管理画面にログイン済み |
| **事後条件** | 設定がDBに保存、期限切れデータが削除 |

**設定項目**:

| 項目 | 説明 | デフォルト |
|------|------|-----------|
| 履歴保存期間 | 発着信履歴の保存日数 | 365日 |
| 録音保存期間 | 録音ファイルの保存日数 | 90日 |
| 自動削除 | 保存期間経過後に自動削除 | ON |

**基本フロー（手動削除）**:

| # | アクター | Frontend | S3 |
|---|---------|----------|-----|
| 1 | 履歴画面で削除対象を選択 | | |
| 2 | 「削除」をクリック | | |
| 3 | | 確認ダイアログ表示 | |
| 4 | 「削除する」をクリック | | |
| 5 | | Frontend DBから履歴削除 | |
| 6 | | S3から録音ファイル削除 | ファイル削除 |

---

#### UC-F12: Backendの稼働状態を確認する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F12 |
| **アクター** | 管理者、履歴閲覧者 |
| **システム** | Frontend（AWS） |
| **概要** | オンプレミスBackendの稼働状態をリアルタイム確認 |
| **事前条件** | 管理画面にログイン済み |
| **事後条件** | なし（参照のみ） |

**表示項目**:

| 項目 | 説明 |
|------|------|
| 接続状態 | オンライン / オフライン |
| 最終応答時刻 | Backend APIからの最終レスポンス時刻 |
| 最終同期時刻 | 設定/履歴の最終同期時刻 |
| SIP接続状態 | ひかり電話回線との接続状態 |
| 同時通話数 | 現在の通話数 / 上限（0/2） |

**基本フロー**:

| # | アクター | Frontend | Backend |
|---|---------|----------|---------|
| 1 | ダッシュボード/ステータス画面を開く | | |
| 2 | | Backend /api/health を呼び出し | ヘルスチェック応答 |
| 3 | | ステータスを表示 | |
| 4 | | 30秒ごとに自動更新 | |

**代替フロー**:

| 条件 | 処理 |
|------|------|
| Backend応答なし | 「オフライン」表示、アラート |
| SIP切断 | 「回線切断」表示、アラート |

---

#### UC-F13: 初期設定ウィザードを完了する

| 項目 | 内容 |
|------|------|
| **ID** | UC-F13 |
| **アクター** | 管理者 |
| **システム** | Frontend（AWS） |
| **概要** | 初回ログイン時のガイド付き初期設定 |
| **事前条件** | 初回ログイン、または設定リセット後 |
| **事後条件** | 基本設定完了、通常画面へ遷移 |

**ウィザードステップ**:

| ステップ | 内容 |
|---------|------|
| 1. ようこそ | システム概要説明 |
| 2. Backend接続 | BackendのURL/認証情報入力、接続テスト |
| 3. 通知設定 | メールアドレス、通知ON/OFF |
| 4. 迷惑電話リスト | よくある迷惑電話番号をプリセットからインポート（任意） |
| 5. 完了 | ダッシュボードへ遷移 |

**基本フロー**:

| # | アクター | Frontend | Backend |
|---|---------|----------|---------|
| 1 | 初回ログイン | | |
| 2 | | ウィザード画面を表示 | |
| 3 | 各ステップで情報入力 | | |
| 4 | Backend接続テスト | Backend APIを呼び出し | 応答 |
| 5 | 「完了」をクリック | | |
| 6 | | 設定をDBに保存 | |
| 7 | | ダッシュボードへ遷移 | |

---

#### UC-F14: IVRシナリオをプレビューする

| 項目 | 内容 |
|------|------|
| **ID** | UC-F14 |
| **アクター** | 管理者 |
| **システム** | Frontend（AWS） |
| **概要** | IVRシナリオを本番適用前にブラウザでテスト再生 |
| **事前条件** | IVR設定画面でシナリオ編集中 |
| **事後条件** | なし（テストのみ） |

**基本フロー**:

| # | アクター | Frontend |
|---|---------|----------|
| 1 | 「プレビュー」をクリック | |
| 2 | | IVRシミュレーター画面を表示 |
| 3 | | ウェルカムメッセージを再生 |
| 4 | | 仮想テンキーを表示 |
| 5 | テンキーでDTMF入力 | |
| 6 | | 入力に応じたメニュー遷移を再現 |
| 7 | 「終了」をクリック | |
| 8 | | 編集画面に戻る |

---

## 7.3.2 Backend利用者ユースケース（発信者/顧客）

> Backend（オンプレミス上のRustシステム）と電話回線経由で対話するユーザーのユースケース

#### UC-B01: 着信処理

| 項目 | 内容 |
|------|------|
| **ID** | UC-B01 |
| **アクター** | 発信者（顧客） |
| **システム** | Backend（オンプレミス） |
| **概要** | 電話着信を受け、番号に応じた振り分け処理を実行 |
| **事前条件** | Backend稼働中、ひかり電話回線接続中 |
| **事後条件** | 着信処理完了、履歴をFrontendに同期 |

**基本フロー**:

| # | アクター | Backend | Frontend |
|---|---------|---------|----------|
| 1 | 電話をかける | | |
| 2 | | SIPでINVITE受信、発信者番号取得 | |
| 3 | | ローカルDBで振り分けルール照合 | |
| 4 | | ルールに応じたアクション実行 | |
| 5 | | ローカルDBに履歴記録 | |
| 6 | | Frontend APIを呼び出し | 履歴を受信・Frontend DBに保存 |

**振り分けアクション**:

| カテゴリ | アクション | 詳細 |
|---------|-----------|------|
| 迷惑電話 | 居留守 | 応答せず10コール後切断 |
| 迷惑電話 | お断り | 「受付しておりません」アナウンス後切断 |
| 一般 | IVR | UC-B02へ遷移 |
| VIP | 着信転送 | 即座に指定内線へ転送 |
| 留守電 | 録音 | メッセージ録音モード |

---

#### UC-B02: IVR実行

| 項目 | 内容 |
|------|------|
| **ID** | UC-B02 |
| **アクター** | 発信者（顧客） |
| **システム** | Backend（オンプレミス） |
| **概要** | 自動音声ガイダンスに従い、DTMF入力でメニュー選択 |
| **事前条件** | UC-B01で「IVR」アクションに振り分けられた |
| **事後条件** | 選択に応じた処理完了 |

**基本フロー**:

| # | アクター | Backend |
|---|---------|---------|
| 1 | | 録音通知アナウンス再生（設定時） |
| 2 | | ウェルカムメッセージ再生 |
| 3 | | メニューオプション読み上げ |
| 4 | DTMFキー（0-9）を押す | |
| 5 | | DTMF入力検知 |
| 6 | | 入力に応じた処理実行（転送/サブメニュー/終了） |

**代替フロー**:

| 条件 | 処理 |
|------|------|
| タイムアウト（入力なし） | 再読み上げ → 2回目で切断 |
| 無効な入力 | 「入力が正しくありません」→ 再読み上げ |
| サブメニュー選択 | 次階層へ遷移（最大3階層） |

---

#### UC-B03: 通話録音

| 項目 | 内容 |
|------|------|
| **ID** | UC-B03 |
| **アクター** | 発信者（顧客） |
| **システム** | Backend（オンプレミス）、S3 |
| **概要** | 通話音声を録音し、S3に保存 |
| **事前条件** | 録音ONの番号設定 |
| **事後条件** | WAVファイルがS3に保存、メタデータをFrontendに同期 |

**基本フロー**:

| # | Backend | S3 | Frontend |
|---|---------|-----|----------|
| 1 | 録音通知アナウンス再生 | | |
| 2 | RTP音声をローカルバッファに記録 | | |
| 3 | 通話終了を検知 | | |
| 4 | WAVファイル生成 | | |
| 5 | S3にアップロード | ファイル保存 | |
| 6 | Frontend APIを呼び出し | | メタデータ保存 |

---

#### UC-B04: 履歴同期

| 項目 | 内容 |
|------|------|
| **ID** | UC-B04 |
| **システム** | Backend → Frontend |
| **概要** | 通話終了時に履歴データをFrontendにPush |
| **トリガー** | 通話終了、録音完了 |

**同期データ**:

| 項目 | 説明 |
|------|------|
| call_id | 通話識別子 |
| caller_number | 発信者番号 |
| called_at | 着信日時 |
| duration | 通話時間 |
| action | 実行アクション |
| recording_url | S3録音URL（録音ありの場合） |

---

#### UC-B05: 設定取得

| 項目 | 内容 |
|------|------|
| **ID** | UC-B05 |
| **システム** | Backend ← Frontend |
| **概要** | Backend起動時または設定変更時に最新設定を取得 |
| **トリガー** | Backend起動、Frontend設定保存 |

**取得データ**:

| 項目 | 説明 |
|------|------|
| phone_numbers | 電話番号設定一覧 |
| routing_rules | 振り分けルール一覧 |
| ivr_scenarios | IVRシナリオ一覧 |

---

## 7.3.3 開発者ユースケース

> Backend環境の構築・開発を行う開発者のユースケース

#### UC-D01: Backend環境を構築する

| 項目 | 内容 |
|------|------|
| **ID** | UC-D01 |
| **アクター** | Backend開発者 |
| **概要** | Raspberry Pi/PCにBackend環境を構築 |

**作業内容**:

| # | 作業 | 詳細 |
|---|------|------|
| 1 | OS設定 | Raspberry Pi OS / Ubuntu設定 |
| 2 | Rustインストール | rustup, cargo設定 |
| 3 | PostgreSQLインストール | ローカルDB設定 |
| 4 | ひかり電話SIP設定 | SIP認証情報、RTPポート設定 |
| 5 | Backendビルド・起動 | `cargo build --release` |
| 6 | Frontend API接続設定 | エンドポイント、認証トークン設定 |
| 7 | 動作確認 | テスト発信で着信確認 |

---

#### UC-D02: Frontend-Backend APIを開発する

| 項目 | 内容 |
|------|------|
| **ID** | UC-D02 |
| **アクター** | Backend開発者 |
| **概要** | Frontend-Backend間のREST APIを実装 |

**API一覧**:

| メソッド | エンドポイント | 方向 | 説明 |
|---------|---------------|------|------|
| POST | /api/sync/settings | F→B | 設定Push |
| GET | /api/sync/settings | B→F | 設定Pull（起動時） |
| POST | /api/sync/history | B→F | 履歴Push |
| POST | /api/sync/recording | B→F | 録音メタデータPush |
| GET | /api/health | - | ヘルスチェック |

---

## 7.3.4 運用者ユースケース

> システムの日常運用・監視を行う運用者のユースケース

#### UC-O01: システムを監視する

| 項目 | 内容 |
|------|------|
| **ID** | UC-O01 |
| **アクター** | システム運用者 |
| **概要** | Frontend/Backendの稼働状況を監視 |

**監視項目**:

| 対象 | 項目 | 閾値 |
|------|------|------|
| Backend | プロセス稼働 | 停止でアラート |
| Backend | SIP接続状態 | 切断でアラート |
| Backend | ローカルDB接続 | 接続失敗でアラート |
| Frontend | APIレスポンス | 5秒以上でアラート |
| Frontend | RDS接続 | 接続失敗でアラート |
| 同期 | 最終同期時刻 | 5分以上でアラート |

---

#### UC-O02: 障害に対応する

| 項目 | 内容 |
|------|------|
| **ID** | UC-O02 |
| **アクター** | システム運用者 |
| **概要** | 障害発生時の対応手順 |

**障害パターンと対応**:

| 障害 | 影響 | 対応 |
|------|------|------|
| Backend停止 | 着信不可 | プロセス再起動 |
| SIP切断 | 着信不可 | ひかり電話回線確認、SIP再接続 |
| Frontend-Backend通信断 | 設定同期不可、履歴表示不可 | ネットワーク確認、API再接続 |
| S3接続失敗 | 録音保存不可 | AWS認証確認、ローカル一時保存 |
| RDS接続失敗 | 管理画面表示不可 | RDS状態確認、再起動 |

---

#### UC-O03: バックアップを取得する

| 項目 | 内容 |
|------|------|
| **ID** | UC-O03 |
| **アクター** | システム運用者 |
| **概要** | 定期的なデータバックアップ |

**バックアップ対象**:

| 対象 | 頻度 | 保存先 |
|------|------|--------|
| Backend PostgreSQL | 日次 | S3 |
| Frontend PostgreSQL (RDS) | 日次 | RDS自動バックアップ |
| 録音ファイル | リアルタイム | S3（バージョニング有効） |
| 設定ファイル | 変更時 | Git |

---

#### UC-O04: データ同期を確認する

| 項目 | 内容 |
|------|------|
| **ID** | UC-O04 |
| **アクター** | システム運用者 |
| **概要** | Frontend-Backend間のデータ同期状態を確認・修復 |

**確認項目**:

| 項目 | 確認方法 |
|------|----------|
| 設定同期 | Frontend設定数 = Backend設定数 |
| 履歴同期 | Backend履歴 ⊆ Frontend履歴 |
| 録音同期 | 録音メタデータ数 = S3オブジェクト数 |

**修復手順**:

| 状況 | 対応 |
|------|------|
| 設定不一致 | Frontend → Backend 全件再同期 |
| 履歴不一致 | Backend → Frontend 差分同期 |
| 録音不一致 | S3オブジェクト一覧と照合、欠損ファイル再アップロード |

---

### 7.4 ユースケース・機能要件トレーサビリティ

| カテゴリ | ユースケース | 関連FR | 優先度 |
|---------|-------------|--------|:------:|
| **Frontend** | UC-F01: 番号設定 | FR-100, FR-103, FR-104 | P0 |
| | UC-F02: IVR設定 | FR-122, FR-145 | P0 |
| | UC-F03: ルール設定 | FR-101, FR-102, FR-115 | P0 |
| | UC-F04: 履歴確認 | FR-140, FR-141 | P0 |
| | UC-F05: 録音再生 | FR-142, FR-143 | P0 |
| | UC-F06: ダッシュボード | FR-150（新規） | P0 |
| | UC-F07: 通知設定 | FR-151（新規） | P1 |
| | UC-F08: 一括インポート/エクスポート | FR-152（新規） | P1 |
| | UC-F09: 統計・レポート | FR-153（新規） | P1 |
| | UC-F10: クイックアクション | FR-140（拡張） | P0 |
| | UC-F11: データ保存期間管理 | FR-154（新規） | P1 |
| | UC-F12: Backendステータス確認 | FR-155（新規） | P0 |
| | UC-F13: 初期設定ウィザード | FR-156（新規） | P1 |
| | UC-F14: IVRプレビュー | FR-122（拡張） | P2 |
| **Backend** | UC-B01: 着信処理 | FR-100, FR-101, FR-102, FR-111, FR-112 | P0 |
| | UC-B02: IVR実行 | FR-120, FR-121, FR-123, FR-124, FR-125 | P0 |
| | UC-B03: 通話録音 | FR-130, FR-131, FR-132, FR-133 | P0 |
| | UC-B04: 履歴同期 | FR-140（Backend側） | P0 |
| | UC-B05: 設定取得 | FR-100（同期） | P0 |
| **開発** | UC-D01: 環境構築 | NFR-130 | - |
| | UC-D02: API開発 | （新規） | - |
| **運用** | UC-O01: 監視 | NFR-130, NFR-131 | - |
| | UC-O02: 障害対応 | NFR-111, NFR-112 | - |
| | UC-O03: バックアップ | NFR-132 | - |
| | UC-O04: 同期確認 | （新規） | - |

#### 新規機能要件（追加）

| ID | 要件 | 優先度 | 対応UC |
|----|------|:------:|--------|
| FR-150 | ダッシュボード表示 | P0 | UC-F06 |
| FR-151 | 通知機能（ブラウザ/メール） | P1 | UC-F07 |
| FR-152 | CSV一括インポート/エクスポート | P1 | UC-F08 |
| FR-153 | 統計・レポート生成 | P1 | UC-F09 |
| FR-154 | データ保存期間設定・自動削除 | P1 | UC-F11 |
| FR-155 | Backendヘルスチェック表示 | P0 | UC-F12 |
| FR-156 | 初期設定ウィザード | P1 | UC-F13 |

---

## 8. 受入条件サマリー

| AC | 内容 | 優先度 | 対応FR |
|----|------|:------:|--------|
| AC-100 | 番号登録・振り分けルール設定 | P0 | FR-100〜103 |
| AC-101 | 居留守対応（無応答→切断） | P0 | FR-111 |
| AC-102 | お断りアナウンス再生→切断 | P0 | FR-112 |
| AC-103 | IVR基本フロー（DTMF選択→転送） | P0 | FR-120〜125 |
| AC-104 | 通話録音・録音通知アナウンス | P0 | FR-130〜133 |
| AC-105 | 発着信履歴一覧・検索 | P0 | FR-140〜141 |
| AC-106 | 録音ファイル再生（シーク対応） | P0 | FR-142 |
| AC-107 | 電話番号設定画面 | P0 | FR-144 |
| AC-108 | 管理画面認証 | P0 | FR-147 |

---

## 8. 前提条件・依存関係

### 8.1 前提条件

- ひかり電話回線がSIPで接続可能であること
- 既存のVoicebot Backend（RD-001）が稼働していること
- Frontend（管理画面）の開発リソースが確保されていること

### 8.2 依存関係

| 依存先 | 種別 | 説明 |
|--------|------|------|
| RD-001 | 必須 | SIP/RTP基盤、録音機能 |
| ひかり電話回線 | 必須 | SIP接続設定 |
| Frontend | 必須 | 管理画面の実装 |

### 8.3 使用技術

#### Backend

| カテゴリ | 技術 | バージョン | 備考 |
|---------|------|-----------|------|
| 言語 | **Rust** | Edition 2021 | メモリ安全性・高性能 |
| 非同期ランタイム | tokio | 1.x | async I/O |
| SIPパーサ | nom | 7.x | RFC 3261準拠 |
| 音声処理 | hound | 3.x | WAV録音 |
| HTTPサーバ | axum | 0.7+ | 録音配信・API |
| AI連携 | reqwest | 0.12 | ASR/LLM/TTS API |
| AWS | aws-sdk-* | 1.x | S3/Transcribe等 |

> 詳細は [DD-001 技術スタック](../virtual-voicebot-backend/docs/design/detail/DD-001_tech-stack.md) を参照

#### Frontend

| カテゴリ | 技術 | バージョン | 備考 |
|---------|------|-----------|------|
| フレームワーク | **Next.js** | 14.x+ | App Router、SSR/SSG対応 |
| 言語 | **TypeScript** | 5.x | 型安全 |
| UIライブラリ | React | 18.x | Next.js同梱 |
| スタイリング | Tailwind CSS | 3.x | ユーティリティファースト |
| 状態管理 | React Context / Zustand | - | 軽量な状態管理 |
| APIクライアント | fetch / SWR | - | データフェッチ・キャッシュ |
| 認証 | NextAuth.js | - | シングルユーザー向け簡易認証 |
| テスト | Jest + React Testing Library | - | UT/コンポーネントテスト |

#### 共通インフラ

| カテゴリ | 技術 | 備考 |
|---------|------|------|
| コンテナ | Docker | 開発・本番環境統一 |
| Frontend DB | **PostgreSQL** (AWS RDS) | 表示用・設定マスター |
| Backend DB | **PostgreSQL** (ローカル) | 通話データ・リアルタイム処理 |
| ストレージ | AWS S3 | 録音ファイル保存 |
| CI/CD | GitHub Actions | ビルド・テスト・デプロイ |

#### デプロイ構成（将来）

```
┌─────────────────────────────────────────────────────────────┐
│                        インターネット                         │
└─────────────────────────────────────────────────────────────┘
        │                                    │
        ▼                                    ▼
┌───────────────────┐              ┌───────────────────────────┐
│   AWS (クラウド)   │              │   自宅/オフィス (オンプレ)   │
│                   │              │                           │
│  ┌─────────────┐  │   REST API   │  ┌───────────────────────┐│
│  │  Frontend   │◄─┼──────────────┼─►│       Backend        ││
│  │  (Next.js)  │  │   (HTTPS)    │  │    (Rust/SIP/RTP)    ││
│  └──────┬──────┘  │              │  └───────────┬───────────┘│
│         │         │              │              │            │
│         ▼         │              │              ▼            │
│  ┌─────────────┐  │              │  ┌───────────────────────┐│
│  │ PostgreSQL  │  │              │  │     PostgreSQL       ││
│  │   (RDS)     │  │              │  │    (ローカル)         ││
│  └─────────────┘  │              │  └───────────────────────┘│
│                   │              │                           │
│  ┌─────────────┐  │  録音upload  │  ┌───────────────────┐    │
│  │     S3      │◄─┼──────────────┼──┤  ひかり電話回線    │    │
│  │  (録音保存)  │  │              │  │   (SIP接続)       │    │
│  └─────────────┘  │              │  └───────────────────┘    │
└───────────────────┘              └───────────────────────────┘
```

| コンポーネント | デプロイ先 | 用途 |
|---------------|-----------|------|
| Frontend | **AWS** (Vercel/Amplify/EC2) | 管理画面UI |
| Frontend DB | **AWS RDS** (PostgreSQL) | 表示用データ、ユーザー設定 |
| Backend | **Raspberry Pi / PC** | SIP/RTP処理、通話制御 |
| Backend DB | **ローカル** (PostgreSQL) | 通話データ、リアルタイム処理用 |
| 録音ストレージ | **AWS S3** | 録音ファイル保存 |

#### データ同期

Frontend ↔ Backend 間は **REST API** でデータ連携する（DB直接共有しない）。

```
┌──────────────┐                      ┌──────────────┐
│ Frontend DB  │                      │ Backend DB   │
│  (AWS RDS)   │                      │  (ローカル)   │
└──────┬───────┘                      └──────┬───────┘
       │                                     │
       ▼                                     ▼
┌──────────────┐      REST API        ┌──────────────┐
│   Frontend   │◄────────────────────►│   Backend    │
│  (Next.js)   │                      │   (Rust)     │
└──────────────┘                      └──────────────┘
```

| データ | マスター | 同期方向 | 説明 |
|--------|---------|---------|------|
| 電話番号設定 | Frontend | Frontend → Backend | 設定変更時にAPI経由でPush |
| IVRシナリオ | Frontend | Frontend → Backend | 設定変更時にAPI経由でPush |
| 発着信履歴 | Backend | Backend → Frontend | 通話終了時にAPI経由でPush |
| 録音メタデータ | Backend | Backend → Frontend | 録音完了時にAPI経由でPush |
| 録音ファイル | Backend | Backend → S3 → Frontend | S3経由で配信 |

> **Note**: Backend は起動時に Frontend API から最新設定を取得（Pull）する運用も検討

---

## 9. 用語定義

| 用語 | 定義 |
|------|------|
| DTMF | Dual-Tone Multi-Frequency。プッシュボタン入力のトーン信号 |
| IVR | Interactive Voice Response。自動音声応答システム |
| VIP | Very Important Person。重要顧客 |
| SES | システムエンジニアリングサービス。技術者派遣業者 |
| 居留守 | 着信に応答せず、一定コール後に切断する対応 |

---

## 10. 未確定事項（Open Questions）

- [x] Q1: ひかり電話回線のSIP接続仕様は確認済みか？ → **Yes（確認済み）**
- [x] Q2: 同時通話数の上限は何通話を想定するか？ → **2通話**
- [ ] Q3: 録音データの保存期間とストレージ容量の見積もりは？ → **TBD**
- [x] Q4: 管理画面のユーザー数・権限体系は？ → **個人開発のため管理者のみ（シングルユーザー）**
- [x] Q5: IVRのシナリオ数・階層数の上限は？ → **DTMF: 0-9（10選択肢）、階層数: 最大3階層**
- [x] Q6: 既存のIVRシステムとの統合または置き換えか？ → **新規構築（本システムベース）、既存IVRとの統合なし**

---

## 11. 参照ドキュメント

| ドキュメント | 説明 |
|-------------|------|
| [RD-001](RD-001_product.md) | Voicebot基盤の要件定義 |
| [BD-001](../design/basic/BD-001_architecture.md) | システムアーキテクチャ |
| [DD-003](../design/detail/DD-003_sip.md) | SIPモジュール詳細設計 |

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|-----------|---------|--------|
| 2026-01-31 | 0.1 | 初版ドラフト | @MasanoriSuda + Claude Code |
| 2026-01-31 | 0.2 | ユースケース詳細展開（§7追加） | @MasanoriSuda + Claude Code |
| 2026-01-31 | 0.3 | Open Questions回答反映（Q1,Q2,Q4,Q5,Q6）、NFR/FR更新 | @MasanoriSuda + Claude Code |
| 2026-01-31 | 0.4 | 使用技術（§8.3）追加：Backend(Rust)/Frontend(Next.js)/共通インフラ | @MasanoriSuda + Claude Code |
| 2026-01-31 | 0.5 | DB確定(PostgreSQL)、デプロイ構成追加(Frontend:AWS, Backend:ラズパイ/PC) | @MasanoriSuda + Claude Code |
| 2026-01-31 | 0.6 | DB分離構成に変更（Frontend:RDS, Backend:ローカル）、API同期方式追加 | @MasanoriSuda + Claude Code |
| 2026-01-31 | 0.7 | §7ユースケースを4カテゴリで再構成（Frontend利用者/Backend利用者/開発者/運用者） | @MasanoriSuda + Claude Code |
| 2026-01-31 | 0.8 | Frontend利用者UC追加（UC-F06〜F14）: ダッシュボード/通知/一括操作/統計/クイックアクション/データ管理/ステータス確認/初期設定/IVRプレビュー | @MasanoriSuda + Claude Code |
