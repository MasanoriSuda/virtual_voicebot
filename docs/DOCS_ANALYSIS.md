# ドキュメント整理分析レポート

作成日: 2025-12-25

---

## 1. 重複・矛盾の発見

### 1.1 AGENTS.md の重複

| ファイル | 内容 | 状態 |
|---------|------|------|
| `/AGENTS.md` | "TBD" のみ | **空/未使用** |
| `/virtual-voicebot-backend/AGENTS.md` | 詳細なCodex指示書（181行） | **正本候補** |

**矛盾点**: なし（ルートが空のため）
**問題**: ルートAGENTS.mdが存在するがTBDのまま放置

### 1.2 SIP関連ドキュメントの重複

| ファイル | 内容 | 行数 | 状態 |
|---------|------|------|------|
| `docs/sip.md` | トランザクション状態遷移表、I/F設計、MVP範囲 | 154行 | **正本候補** |
| `src/sip/README.md` | モジュール概要（責務・依存関係） | 19行 | 補助 |

**矛盾点**: なし（README.mdはsip.mdのサブセット）
**問題**: 内容の重複があるが、粒度が異なるため共存可能

### 1.3 RTP関連ドキュメントの重複

| ファイル | 内容 | 行数 | 状態 |
|---------|------|------|------|
| `docs/rtp.md` | 詳細設計（SSRC管理、ジッタ、RTCP） | 143行 | **正本候補** |
| `src/rtp/README.md` | "未着手" "プレースホルダ" の記述 | 7行 | **要更新（陳腐化）** |

**矛盾点**:
- `src/rtp/README.md` は「rtp モジュールへの委譲は未着手」と記載
- 実際は `docs/todo_rtp.md` で全タスクが完了済み `[x]`
- `docs/rtp.md` には実装済みの詳細が記載

**問題**: `src/rtp/README.md` が実態と乖離

### 1.4 TODO関連ファイルの重複

| ファイル | 役割 | 完了率 | 状態 |
|---------|------|--------|------|
| `docs/todo.md` | マスターTODO | MVP完了、NEXT一部残 | **正本** |
| `docs/todo_sip.md` | SIP詳細タスク | 全完了 `[x]` | **アーカイブ候補** |
| `docs/todo_rtp.md` | RTP詳細タスク | 全完了 `[x]` | **アーカイブ候補** |
| `docs/todo_session.md` | Session詳細タスク | 全完了 `[x]` | **アーカイブ候補** |
| `docs/todo_transport.md` | Transport詳細タスク | 1つ残 `[ ]` | 移動後アーカイブ |
| `docs/todo_ai.md` | AI詳細タスク | 3つ残 `[ ]` | アクティブ |
| `docs/todo_app_ai.md` | App/AI詳細タスク | 全完了 `[x]` | **アーカイブ候補** |
| `docs/todo_media.md` | Media詳細タスク | MVP一部残、NEXT残 | アクティブ |
| `docs/todo_tests_ops.md` | Tests/Ops詳細タスク | 全未完了 `[ ]` | アクティブ |

**問題**:
- 完了済みのTODOファイルが個別に存在し続けている（4ファイル）
- `todo.md` にも同じ内容が重複して記載されている
- どちらを更新すべきか不明確
- アクティブなTODOファイルが分散（todo_ai, todo_media, todo_tests_ops）

### 1.5 E2E/SIPp手順の重複

| ファイル | 内容 | 状態 |
|---------|------|------|
| `docs/tests_e2e_sipp.md` | SIPp E2E手順（compose, ローカル実行） | **正本候補** |
| `test/README.md` | E2Eランナー使用方法 | 補助 |
| `AGENTS.md §10` | SIPp配置・実行ルール（約35行） | **重複** |

**矛盾点**:
- `AGENTS.md` と `docs/tests_e2e_sipp.md` に同じ情報が分散
- compose コマンド、シナリオパス、環境変数が両方に記載

**問題**: 更新時に両方を変更する必要があり、不整合リスクが高い

### 1.6 空/未使用ファイル

| ファイル | 状態 |
|---------|------|
| `docs/current-spec.md` | **空ファイル** |
| `/AGENTS.md` | "TBD" のみ |

---

## 2. 正本・統合・Deprecated 提案

### 2.1 AGENTS.md

| 提案 | 対象 | アクション |
|------|------|-----------|
| **正本** | `/virtual-voicebot-backend/AGENTS.md` | 維持 |
| **Deprecated** | `/AGENTS.md` | 削除、またはbackendへのシンボリックリンク/参照に置換 |

**理由**: backendのAGENTS.mdが実質的な正本として機能している

### 2.2 SIP関連

| 提案 | 対象 | アクション |
|------|------|-----------|
| **正本** | `docs/sip.md` | 詳細設計の正本として維持 |
| **補助** | `src/sip/README.md` | 「詳細は docs/sip.md を参照」リンクを追加 |

### 2.3 RTP関連

| 提案 | 対象 | アクション |
|------|------|-----------|
| **正本** | `docs/rtp.md` | 詳細設計の正本として維持 |
| **要更新** | `src/rtp/README.md` | 内容を現状に合わせて更新し、「詳細は docs/rtp.md を参照」を追加 |

### 2.4 TODO関連

| 提案 | 対象 | アクション |
|------|------|-----------|
| **正本** | `docs/todo.md` | 全体TODOの正本として維持 |
| **アーカイブ** | `docs/todo_sip.md` | 全完了→アーカイブ |
| **アーカイブ** | `docs/todo_rtp.md` | 全完了→アーカイブ |
| **アーカイブ** | `docs/todo_session.md` | 全完了→アーカイブ |
| **アーカイブ** | `docs/todo_app_ai.md` | 全完了→アーカイブ |
| **移動→アーカイブ** | `docs/todo_transport.md` | 残1タスクをtodo.mdに移動後アーカイブ |
| **維持/統合検討** | `docs/todo_ai.md` | 残タスクあり（3件） |
| **維持/統合検討** | `docs/todo_media.md` | 残タスクあり（MVP3件+NEXT3件） |
| **維持/統合検討** | `docs/todo_tests_ops.md` | 残タスクあり（全9件未完了） |

**統合案**:
- 完了済みファイル（4件）は `docs/archive/` に移動してアーカイブ
- アクティブな3ファイル（ai, media, tests_ops）は `todo.md` のセクションに統合を検討
- 今後はモジュール別TODOを廃止し、`todo.md` 内のセクションで一元管理

### 2.5 E2E/SIPp手順

| 提案 | 対象 | アクション |
|------|------|-----------|
| **正本** | `docs/tests_e2e_sipp.md` | E2E手順の正本として維持・拡充 |
| **補助** | `test/README.md` | ランナー使用方法のみに絞る |
| **リンク化** | `AGENTS.md §10` | SIPp詳細を削除し、`docs/tests_e2e_sipp.md` へのリンクに置換 |

### 2.6 空/未使用ファイル

| 提案 | 対象 | アクション |
|------|------|-----------|
| **削除** | `docs/current-spec.md` | 空ファイルのため削除 |
| **削除/置換** | `/AGENTS.md` | 削除、またはbackend参照に置換 |

---

## 3. 確認質問

以下の点について確認が必要です：

### Q1. モジュール別TODO（todo_*.md）の扱い
- **選択肢A**: 完了済みファイルは `docs/archive/` に移動してアーカイブ
- **選択肢B**: 完了済みファイルは削除し、履歴はgitで管理
- **選択肢C**: 現状維持（完了済みも残す）

### Q2. src/*/README.md の粒度
- **選択肢A**: 最小限（責務・依存のみ）にして詳細は docs/*.md へリンク
- **選択肢B**: docs/*.md の内容を src/*/README.md に統合
- **選択肢C**: 現状維持（一部重複を許容）

### Q3. AGENTS.md の配置
- **選択肢A**: backendのAGENTS.mdをルートに移動（monorepo共通化）
- **選択肢B**: ルートAGENTS.mdを削除しbackendのみ維持
- **選択肢C**: ルートからbackendへの参照リンクを記載

### Q4. advenc_calendar/ ディレクトリ
- 開発日誌のようなファイル群（20251216.md等）が存在
- **選択肢A**: docs/archive/devlog/ に移動
- **選択肢B**: 現状維持
- **選択肢C**: 削除（必要なら git 履歴から参照）

---

## 4. 移行チェックリスト（ドラフト）

確認質問の回答後、以下を確定します：

### Phase 1: 即時対応（矛盾解消）

| # | ファイル | アクション | 理由 |
|---|---------|-----------|------|
| 1 | `docs/current-spec.md` | 削除 | 空ファイル |
| 2 | `/AGENTS.md` | backendへの参照に置換 | TBDのまま放置 |
| 3 | `src/rtp/README.md` | 更新 | 実態と乖離 |

### Phase 2: 統合・簡素化

| # | ファイル | アクション | 理由 |
|---|---------|-----------|------|
| 4 | `docs/todo_sip.md` | アーカイブ | 全タスク完了 |
| 5 | `docs/todo_rtp.md` | アーカイブ | 全タスク完了 |
| 6 | `docs/todo_session.md` | アーカイブ | 全タスク完了 |
| 7 | `docs/todo_app_ai.md` | アーカイブ | 全タスク完了 |
| 8 | `docs/todo_transport.md` | 残タスク移動→アーカイブ | 1タスク残 |
| 9 | `docs/todo_ai.md` | todo.mdに統合検討 | 3タスク残 |
| 10 | `docs/todo_media.md` | todo.mdに統合検討 | 6タスク残 |
| 11 | `docs/todo_tests_ops.md` | todo.mdに統合検討 | 9タスク残 |
| 12 | `AGENTS.md §10 SIPp` | リンク化 | 重複解消 |

### Phase 3: ポリシー適用

| # | ファイル | アクション | 理由 |
|---|---------|-----------|------|
| 13 | `docs/DOCS_POLICY.md` | 新規作成（ドラフト済み） | 正本ルール明文化 |
| 14 | `docs/DOCS_INDEX.md` | 新規作成（ドラフト済み） | ドキュメント一覧 |
| 15 | 各正本ファイル | ヘッダに正本表記追加 | 識別容易化 |

---

*本分析は調査結果に基づく提案です。最終決定には確認質問への回答が必要です。*
