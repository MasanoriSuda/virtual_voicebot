# ドキュメント整理分析レポート

作成日: 2025-12-25
更新日: 2025-12-27

---

## 1. 重複・矛盾の発見

### 1.1 AGENTS.md の重複

| ファイル | 内容 | 状態 |
|---------|------|------|
| `/AGENTS.md` | "TBD" のみ | **空/未使用** |
| `/virtual-voicebot-backend/AGENTS.md` | 詳細なCodex指示書（181行） | **正本候補** |

**矛盾点**: なし（ルートが空のため）
**問題**: ルートAGENTS.mdが存在するがTBDのまま放置

### 1.2 SIP関連ドキュメントの重複

| ファイル | 内容 | 行数 | 状態 |
|---------|------|------|------|
| `docs/sip.md` | トランザクション状態遷移表、I/F設計、MVP範囲 | 154行 | **正本候補** |
| `src/sip/README.md` | モジュール概要（責務・依存関係） | 19行 | 補助 |

**矛盾点**: なし（README.mdはsip.mdのサブセット）
**問題**: 内容の重複があるが、粒度が異なるため共存可能

### 1.3 RTP関連ドキュメントの重複

| ファイル | 内容 | 行数 | 状態 |
|---------|------|------|------|
| `docs/rtp.md` | 詳細設計（SSRC管理、ジッタ、RTCP） | 143行 | **正本候補** |
| `src/rtp/README.md` | "未着手" "プレースホルダ" の記述 | 7行 | **要更新（陳腐化）** |

**矛盾点**:
- `src/rtp/README.md` は「rtp モジュールへの委譲は未着手」と記載
- 実際は実装完了済み
- `docs/rtp.md` には実装済みの詳細が記載

**問題**: `src/rtp/README.md` が実態と乖離

### 1.4 E2E/SIPp手順の重複

| ファイル | 内容 | 状態 |
|---------|------|------|
| `docs/tests_e2e_sipp.md` | SIPp E2E手順（compose, ローカル実行） | **正本候補** |
| `test/README.md` | E2Eランナー使用方法 | 補助 |
| `AGENTS.md §10` | SIPp配置・実行ルール（約35行） | **重複** |

**矛盾点**:
- `AGENTS.md` と `docs/tests_e2e_sipp.md` に同じ情報が分散
- compose コマンド、シナリオパス、環境変数が両方に記載

**問題**: 更新時に両方を変更する必要があり、不整合リスクが高い

### 1.5 空/未使用ファイル

| ファイル | 状態 |
|---------|------|
| `docs/current-spec.md` | **空ファイル** |
| `/AGENTS.md` | "TBD" のみ |

---

## 2. 正本・統合・Deprecated 提案

### 2.1 AGENTS.md

| 提案 | 対象 | アクション |
|------|------|-----------|
| **正本** | `/virtual-voicebot-backend/AGENTS.md` | 維持 |
| **Deprecated** | `/AGENTS.md` | 削除、またはbackendへのシンボリックリンク/参照に置換 |

**理由**: backendのAGENTS.mdが実質的な正本として機能している

### 2.2 SIP関連

| 提案 | 対象 | アクション |
|------|------|-----------|
| **正本** | `docs/sip.md` | 詳細設計の正本として維持 |
| **補助** | `src/sip/README.md` | 「詳細は docs/sip.md を参照」リンクを追加 |

### 2.3 RTP関連

| 提案 | 対象 | アクション |
|------|------|-----------|
| **正本** | `docs/rtp.md` | 詳細設計の正本として維持 |
| **要更新** | `src/rtp/README.md` | 内容を現状に合わせて更新し、「詳細は docs/rtp.md を参照」を追加 |

### 2.4 E2E/SIPp手順

| 提案 | 対象 | アクション |
|------|------|-----------|
| **正本** | `docs/tests_e2e_sipp.md` | E2E手順の正本として維持・拡充 |
| **補助** | `test/README.md` | ランナー使用方法のみに絞る |
| **リンク化** | `AGENTS.md §10` | SIPp詳細を削除し、`docs/tests_e2e_sipp.md` へのリンクに置換 |

### 2.5 空/未使用ファイル

| 提案 | 対象 | アクション |
|------|------|-----------|
| **削除** | `docs/current-spec.md` | 空ファイルのため削除 |
| **削除/置換** | `/AGENTS.md` | 削除、またはbackend参照に置換 |

---

## 3. 確認質問

以下の点について確認が必要です：

### Q1. src/*/README.md の粒度
- **選択肢A**: 最小限（責務・依存のみ）にして詳細は docs/*.md へリンク
- **選択肢B**: docs/*.md の内容を src/*/README.md に統合
- **選択肢C**: 現状維持（一部重複を許容）

### Q2. AGENTS.md の配置
- **選択肢A**: backendのAGENTS.mdをルートに移動（monorepo共通化）
- **選択肢B**: ルートAGENTS.mdを削除しbackendのみ維持
- **選択肢C**: ルートからbackendへの参照リンクを記載

### Q3. advenc_calendar/ ディレクトリ
- 開発日誌のようなファイル群（20251216.md等）が存在
- **選択肢A**: docs/archive/devlog/ に移動
- **選択肢B**: 現状維持
- **選択肢C**: 削除（必要なら git 履歴から参照）

---

## 4. 移行チェックリスト（ドラフト）

確認質問の回答後、以下を確定します：

### Phase 1: 即時対応（矛盾解消）

| # | ファイル | アクション | 理由 |
|---|---------|-----------|------|
| 1 | `docs/current-spec.md` | 削除 | 空ファイル |
| 2 | `/AGENTS.md` | backendへの参照に置換 | TBDのまま放置 |
| 3 | `src/rtp/README.md` | 更新 | 実態と乖離 |

### Phase 2: 統合・簡素化

| # | ファイル | アクション | 理由 |
|---|---------|-----------|------|
| 4 | `AGENTS.md §10 SIPp` | リンク化 | 重複解消 |

### Phase 3: ポリシー適用

| # | ファイル | アクション | 理由 |
|---|---------|-----------|------|
| 5 | `docs/DOCS_POLICY.md` | 新規作成（ドラフト済み） | 正本ルール明文化 |
| 6 | `docs/DOCS_INDEX.md` | 新規作成（ドラフト済み） | ドキュメント一覧 |
| 7 | 各正本ファイル | ヘッダに正本表記追加 | 識別容易化 |

---

## 5. 完了済み作業

| 日付 | 作業内容 |
|------|---------|
| 2025-12-25 | `docs/todo*.md` 9ファイル削除（todo.md含む） |
| 2025-12-27 | UAS優先方針を gap-analysis.md, PLAN.md, TODO.md に反映 |
| 2025-12-27 | Issue #7 ワークスペース整合性レビュー実施（[結果](reviews/2025-12-27_issue-7.md)） |
| 2025-12-27 | ルート AGENTS.md を共通ルール + backend 参照に更新 |
| 2025-12-27 | `src/rtp/README.md` を実態に合わせて更新 |
| 2025-12-27 | `docs/current-spec.md` 削除（空ファイル） |
| 2025-12-27 | CLAUDE.md に Claude Code/Codex 責務分担表を追加 |
| 2025-12-27 | DOCS_INDEX.md に impl/ セクションを追加 |
| 2025-12-27 | DOCS_POLICY.md 階層図を更新（CLAUDE.md, AGENTS.md, impl/, reviews/ 追加） |
| 2025-12-27 | backend AGENTS.md §10 SIPp をリンク化（tests_e2e_sipp.md へ） |
| 2025-12-27 | design.md に §2.3 確定事項を追加（UAS優先方針） |

---

*本分析は調査結果に基づく提案です。最終決定には確認質問への回答が必要です。*
