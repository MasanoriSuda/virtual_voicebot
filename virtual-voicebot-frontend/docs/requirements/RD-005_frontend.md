# RD-005_frontend

> Frontend 管理画面の要件定義（MVP）

| 項目 | 値 |
|------|-----|
| ID | RD-005 |
| ステータス | Draft |
| 作成日 | 2026-02-02 |
| 更新日 | 2026-02-05 |
| 関連Issue | #89 |
| 対応ST | - |
| 対応BD | [BD-001](../design/basic/BD-001_frontend.md) |

---

## 1. 背景・目的

### 1.1 背景

- Virtual Voicebot Backend が通話処理・録音・AI要約を行う
- 通話終了後の履歴・録音・要約を閲覧するための管理画面が必要
- v0 (Vercel) でプロトタイプを作成済み: [telephony-admin-prototype](https://github.com/MasanoriSuda/telephony-admin-prototype)

### 1.2 目的

- 管理者が通話履歴を一覧・検索・閲覧できる
- 録音の再生、文字起こし、AI要約を確認できる
- 将来的な拡張（IVR設定、ルーティング設定等）の基盤を構築する

---

## 2. スコープ

### 2.1 対象範囲（MVP）

- Dashboard（KPI表示）
- 発着信履歴（一覧・検索・詳細）
- 録音再生・文字起こし・要約表示
- レイアウト（左ナビ + ヘッダー）

### 2.2 対象外（MVP）

- 通話制御（発信/終話/保留）— Backend 側で完結
- IVRフロー編集（ノードエディタ）
- ルーティング設定
- 番号グループ管理
- スケジュール設定
- アナウンス管理
- 設定画面
- 監査ログ
- 迷惑電話対策設定

> 上記は v0 プロトタイプに画面スケルトンがあるが、MVP では実装しない。

---

## 3. 機能要件

### 3.1 レイアウト

| 項目 | 内容 |
|------|------|
| 概要 | 左サイドバー + 上部ヘッダー + メインコンテンツ |
| 入力 | ナビゲーションクリック |
| 出力 | 対応ページへの遷移 |
| 制約 | レスポンシブ対応（タブレット以上） |

**サイドバー項目（MVP）**: Dashboard, 発着信履歴

**ヘッダー項目**: ロゴ / アプリ名, ダークモード切替, ユーザーアバター（将来）

### 3.2 Dashboard

| 項目 | 内容 |
|------|------|
| 概要 | 通話状況の KPI を一覧表示 |
| 入力 | なし（自動更新は将来） |
| 出力 | KPI カード、グラフ |
| 制約 | MVP ではモックデータ可 |
| データソース | **Backend 集計** → Frontend は取得・表示のみ |

**KPI カード（MVP）**:

| カード | 表示内容 |
|--------|---------|
| 本日の総通話数 | 件数 + 前日比 |
| 平均通話時間 | mm:ss 形式 |
| 応答率 | % 表示 |
| （予備） | 将来追加 |

**グラフ（MVP）**: 時間帯別通話数（棒グラフ）

### 3.3 発着信履歴

| 項目 | 内容 |
|------|------|
| 概要 | 通話履歴の一覧表示・検索・詳細表示 |
| 入力 | フィルタ条件、ページネーション |
| 出力 | 通話一覧テーブル |
| 制約 | Backend API `POST /api/ingest/call` で受信したデータを表示 |

**一覧テーブルカラム**:

| カラム | 説明 |
|--------|------|
| 日時 | startedAt（ソート可） |
| 方向 | 着信/発信/不在アイコン |
| 発信者 | from（電話番号 + 名前） |
| 着信先 | to |
| 通話時間 | durationSec → mm:ss 形式 |
| ステータス | status バッジ |
| 操作 | 詳細ボタン |

**フィルタ条件**: 日付範囲（今日/昨日/過去7日/カスタム）, 通話種別（すべて/着信/発信/不在）, キーワード検索（電話番号/名前）

**ページネーション**: 10/25/50 件切替, ページ番号ナビゲーション

### 3.4 通話詳細（3タブ）

| 項目 | 内容 |
|------|------|
| 概要 | 選択した通話の詳細を Drawer/Modal で表示 |
| 入力 | 一覧からの行クリック or 詳細ボタン |
| 出力 | 3タブ（録音/文字起こし/要約） |
| 制約 | recordingUrl が null の場合は「準備中」表示 |

**タブ1: 録音** — 波形付き音声プレイヤー, 再生/一時停止/シーク, 再生速度切替（0.5x/1x/1.5x/2x）, ダウンロードボタン

**タブ2: 文字起こし** — 話者ラベル付きトランスクリプト, タイムスタンプ表示, コピーボタン

> **データ形式**: 3点セットで保存
> 1. 生データ（ベンダー出力）— 原本保存
> 2. UI用正規化 JSON — 共通フォーマット（Frontend で使用）
> 3. 表示用テキスト（SRT/VTT）— 音声プレイヤー連携用

**タブ3: 要約** — AI要約テキスト（summary フィールド）, 要点リスト（将来）

---

## 4. 非機能要件

### 4.1 性能

| 項目 | 要件 |
|------|------|
| 初回表示（LCP） | 3秒以内 |
| 一覧ページ遷移 | 1秒以内 |
| 音声再生開始 | 2秒以内 |

### 4.2 可用性

| 項目 | 要件 |
|------|------|
| 稼働率 | 99%（MVP） |
| 障害復旧 | Backend 依存 |

### 4.3 セキュリティ

| 項目 | 要件（MVP） |
|------|------------|
| 認証 | なし（ローカル/閉域想定） |
| 認可 | なし |
| 通信 | HTTPS |

> 将来: JWT/OAuth 導入予定

### 4.4 ユーザビリティ

| 項目 | 要件 |
|------|------|
| ダークモード | 対応必須 |
| 日本語対応 | 必須 |
| レスポンシブ | タブレット以上 |

---

## 5. 受入条件（Acceptance Criteria）

### レイアウト
- [ ] AC-1: 左サイドバーに Dashboard と発着信履歴のナビゲーションが表示される
- [ ] AC-2: ナビゲーションクリックで対応ページに遷移する
- [ ] AC-3: ダークモード切替ができる

### Dashboard
- [ ] AC-4: KPI カード（本日の通話数、平均通話時間、応答率）が表示される
- [ ] AC-5: 時間帯別通話数グラフが表示される

### 発着信履歴
- [ ] AC-6: 通話履歴が一覧表示される
- [ ] AC-7: 日付範囲でフィルタできる
- [ ] AC-8: 通話種別（着信/発信/不在）でフィルタできる
- [ ] AC-9: ページネーションが動作する
- [ ] AC-10: 行クリックで詳細 Drawer が開く

### 通話詳細
- [ ] AC-11: 録音タブで音声が再生できる
- [ ] AC-12: 文字起こしタブでトランスクリプトが表示される
- [ ] AC-13: 要約タブで AI 要約が表示される
- [ ] AC-14: recordingUrl が null の場合「準備中」と表示される

---

## 6. 前提条件・依存関係

### 6.1 前提条件

- Backend が `POST /api/ingest/call` で通話データを Frontend に送信する
- 録音ファイルは `recordingUrl` 経由で取得可能（Range 対応）
- MVP では認証なし

### 6.2 データ永続化

- **方式**: Frontend 側で Server Sync 機構を構築
- **保存先**: Frontend ローカル DB（PostgreSQL）
- **同期タイミング**: Backend からの `POST /api/ingest/call` 受信時

### 6.3 依存関係

| 依存先 | 種別 | 説明 |
|--------|------|------|
| [contract.md](../../../docs/contract.md) | 必須 | Backend ↔ Frontend API 契約 |
| Backend `/api/ingest/call` | 必須 | 通話データ受信 API |
| 録音ファイル配信 | 必須 | recordingUrl からの音声取得 |

---

## 7. 用語定義

| 用語 | 定義 |
|------|------|
| Call | 1回の通話を表すエンティティ |
| Recording | 通話の録音ファイル |
| Transcript | 音声の文字起こしテキスト |
| Summary | AI による通話要約 |
| KPI | Key Performance Indicator（重要業績評価指標） |

---

## 8. 決定事項（Resolved Questions）

- [x] Q1: 文字起こしデータの形式は？ → 3点セットで保存
- [x] Q2: Dashboard の KPI は Backend 集計 → Frontend は取得・表示のみ
- [x] Q3: 通話データの永続化は Frontend 側ローカル DB に永続化
- [x] Q4: v0 プロトタイプの合流方法 → たたき台として利用中

---

## 9. プロトタイプ参照

| 項目 | 値 |
|------|-----|
| GitHub | [MasanoriSuda/telephony-admin-prototype](https://github.com/MasanoriSuda/telephony-admin-prototype) |
| 技術スタック | Next.js 14 / TypeScript / Tailwind CSS / shadcn/ui |
| パッケージマネージャ | pnpm |

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|-----------|---------|--------|
| 2026-02-02 | 1.0 | 初版作成 | Claude Code |
| 2026-02-02 | 1.1 | Q1〜Q4 解決、データ形式・KPIソース・永続化方式を明記 | Claude Code |
| 2026-02-02 | 1.2 | #62 対応: DB を PostgreSQL に確定 | Claude Code |
| 2026-02-05 | 2.0 | #107 対応: 新構造（virtual-voicebot-frontend/docs/）へ移行・書き直し | Claude Code |
