<!-- SOURCE_OF_TRUTH: Frontend V字モデル -->
# プロセス定義書（PD）— Frontend

> Virtual Voicebot Frontend の開発プロセスを定義する

| 項目 | 値 |
|------|-----|
| ステータス | Draft |
| 作成日 | 2026-02-05 |
| 関連Issue | #107 |

---

## 1. 開発アプローチ

Backend と同じ **ストーリー駆動 × 仕様駆動** のハイブリッドを採用する。

### 1.1 ストーリー駆動の要素

- イシュー/ステアリング単位で変更を管理
- Why（背景・目的）を明示
- Who/When（段取り）を記録

### 1.2 仕様駆動の要素

- 詳細仕様を先に定義してから実装
- V字モデルに沿ったトレーサビリティ
- テストで仕様を検証

### 1.3 統合：ステアリングファイル

- イシューごとにステアリングファイルを作成
- ストーリー（Why/Who/When）+ 仕様（What/How）を一元管理
- 承認後に本体仕様書へマージ

---

## 2. V字モデル

```
【左辺：設計フェーズ】              【右辺：検証フェーズ】

要件定義（RD）◄─────────────────────►システムテスト（ST）
    │   「何を作るか」 ←トレース→ 「要求を満たすか」   │
    ▼                                                 ▲
基本設計（BD）◄─────────────────────►結合テスト（IT）
    │   「どう分けるか」←トレース→「繋がるか」        │
    ▼                                                 ▲
詳細設計（DD）◄─────────────────────►単体テスト（UT）
    │   「どう作るか」 ←トレース→ 「正しく動くか」    │
    ▼                                                 ▲
    └──────────────────► 実装 ◄───────────────────────┘
```

---

## 3. 成果物一覧

### 3.1 プロセス成果物

| ID | 成果物 | 格納先 | 説明 |
|----|--------|--------|------|
| PD | プロセス定義書 | docs/process/v-model.md | 本ファイル |
| QG | 品質ゲート定義 | docs/process/quality-gate.md | フェーズ移行条件 |

### 3.2 V字成果物

| フェーズ | ID | 成果物 | 格納先 | 対応テスト |
|---------|-----|--------|--------|-----------|
| 要件定義 | RD | 要件仕様書 | docs/requirements/RD-xxx.md | ST |
| 基本設計 | BD | 基本設計書 | docs/design/basic/BD-xxx.md | IT |
| 詳細設計 | DD | 詳細設計書 | docs/design/detail/DD-xxx.md | UT |
| テスト | UT | 単体テスト仕様 | docs/test/unit/UT-xxx.md | - |
| テスト | IT | 結合テスト仕様 | docs/test/integration/IT-xxx.md | - |
| テスト | ST | システムテスト仕様 | docs/test/system/ST-xxx.md | - |

### 3.3 ステアリング成果物

| ID | 成果物 | 格納先 | 説明 |
|----|--------|--------|------|
| STEER | ステアリングファイル | docs/steering/STEER-xxx.md | イシュー単位の差分仕様 |

---

## 4. 各フェーズの定義

### 4.1 要件定義（RD）

| 項目 | 内容 |
|------|------|
| 目的 | **何を作るか**を定義する |
| 粒度 | 画面単位・機能単位 |
| 記載内容 | 背景/機能要件/非機能要件/受入条件/スコープ外 |
| 対応テスト | システムテスト（ST） |
| 正本 | docs/requirements/RD-xxx.md |

### 4.2 基本設計（BD）

| 項目 | 内容 |
|------|------|
| 目的 | **どう分けるか**を定義する |
| 粒度 | ページ単位・コンポーネント単位・API Route 単位 |
| 記載内容 | 画面構成/コンポーネントツリー/データフロー/API設計/状態管理方針 |
| 対応テスト | 結合テスト（IT） |
| 正本 | docs/design/basic/BD-xxx.md |

### 4.3 詳細設計（DD）

| 項目 | 内容 |
|------|------|
| 目的 | **どう実装するか**を定義する |
| 粒度 | コンポーネント単位・Hook 単位・関数単位 |
| 記載内容 | Props 定義/Hook 仕様/関数シグネチャ/状態遷移/エラー処理 |
| 対応テスト | 単体テスト（UT） |
| 正本 | docs/design/detail/DD-xxx.md |

### 4.4 実装

| 項目 | 内容 |
|------|------|
| 目的 | 詳細設計どおりにコードを書く |
| 成果物 | ソースコード（TypeScript / React） |
| 制約 | DDに記載のない実装は禁止 |

### 4.5 単体テスト（UT）

| 項目 | 内容 |
|------|------|
| 目的 | 詳細設計（DD）どおりに動くか検証する |
| 粒度 | コンポーネント単位・Hook 単位・関数単位 |
| ツール | Vitest + React Testing Library |

### 4.6 結合テスト（IT）

| 項目 | 内容 |
|------|------|
| 目的 | 基本設計（BD）どおりにコンポーネントが連携するか検証する |
| 粒度 | ページ単位・データフロー単位 |
| ツール | Vitest + MSW（API モック） |

### 4.7 システムテスト（ST）

| 項目 | 内容 |
|------|------|
| 目的 | 要件定義（RD）どおりにシステムが動くか検証する |
| 粒度 | 要件単位・ユースケース単位 |
| ツール | Playwright（E2E） |

---

## 5. ステアリング運用フロー

```
1. イシュー起票
       │
       ▼
2. ステアリングファイル作成（Status: Draft）
   └── ストーリー（Why/Who/When）+ 差分仕様（What/How）を記述
       │
       ▼
3. レビュー（Status: Review）
   └── アーキテクト・POが確認
       │
       ▼
4. 承認（Status: Approved）
   └── 実装GOの判断
       │
       ▼
5. 実装
   └── AIはステアリングファイルをコンテキストとして使用
       │
       ▼
6. コードレビュー
       │
       ▼
7. マージ（Status: Merged）
   └── 差分を本体仕様書（RD/DD/UT等）に反映
   └── ステアリングはアーカイブ
```

---

## 6. AI利用ルール

Backend と共通。詳細は [Backend プロセス定義書 §7](../../virtual-voicebot-backend/docs/process/v-model.md) を参照。

### 6.1 役割分担（Claude Code / Codex）

| 役割 | Claude Code | Codex |
|------|-------------|-------|
| 主担当 | 仕様/ドキュメント（Draft 作成） | 実装/テスト/Review 修正 |
| 出力 | RD/BD/DD/ステアリング（Draft） | ソースコード/ステアリング（Review 修正） |
| コード変更 | しない | する |

**重要な変更（Issue #153）:**
- Claude Code: ステアリング Draft 作成のみ（Review 以降は編集しない）
- Codex: Review 時の修正・段取り更新を担当（レビュー必須）

詳細な RACI マトリクス（フェーズごとの責任分担）は [Backend プロセス定義書 §6.2](../../virtual-voicebot-backend/docs/process/v-model.md) を参照。

---

## 7. コンテキスト最適化

### 7.1 原則

| # | 原則 | 説明 |
|---|------|------|
| 1 | 小さく分割 | 1ドキュメント = 1関心事（100行以下目安） |
| 2 | 明示的に参照 | 「詳細は〇〇を参照」を必ず書く |
| 3 | 階層化 | index → 詳細 の構造 |
| 4 | スコープ限定 | タスクに必要な情報だけ渡す |
| 5 | 正本を明示 | どれが正（Source of Truth）か明記 |

### 7.2 ドキュメント構造

```
virtual-voicebot-frontend/docs/
├── process/           # プロセス定義
│   ├── v-model.md
│   └── quality-gate.md
├── requirements/      # 要件仕様書
│   ├── index.md
│   └── RD-xxx.md
├── design/           # 設計書
│   ├── index.md
│   ├── basic/
│   │   └── BD-xxx.md
│   └── detail/
│       └── DD-xxx.md
├── test/             # テスト仕様書
│   ├── plan.md
│   ├── unit/
│   ├── integration/
│   └── system/
├── steering/         # ステアリング（差分仕様）
│   ├── TEMPLATE.md
│   └── STEER-xxx.md
└── reviews/          # レビュー記録
```

---

## 8. Backend プロセスとの関係

| 観点 | 共通 | Frontend 固有 |
|------|------|-------------|
| V字モデル | 同一構造 | - |
| ステアリング運用 | 同一フロー | - |
| AI利用ルール | 同一 | - |
| 品質ゲート | 構造は同一 | ツールが異なる（ESLint/Vitest vs cargo clippy/cargo test） |
| DD粒度 | - | コンポーネント/Hook/関数の3種 |
| テストツール | - | Vitest / RTL / Playwright |

---

## 9. 参照ドキュメント

| ドキュメント | 説明 |
|-------------|------|
| [品質ゲート定義](quality-gate.md) | Frontend 用フェーズ移行条件 |
| [ステアリングテンプレート](../steering/TEMPLATE.md) | 差分仕様のテンプレート |
| [Backend プロセス定義書](../../virtual-voicebot-backend/docs/process/v-model.md) | Backend 版（参考） |

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|-----------|---------|--------|
| 2026-02-05 | 1.0 | 初版作成 | Claude Code |
